<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="prev" title="常见问题解答(Frequently Asked Questions)" href="faq.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Mypy 版本说明 - mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/mypy_light.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">第一步</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheat_sheet_py3.html">类型提示备忘单</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_code.html">在现有代码库中使用 mypy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">类型系统参考</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="builtin_types.html">内置类型(Built-in)</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_inference_and_annotations.html">类型推断和类型注解(annotations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="kinds_of_types.html">类型的种类(kinds)</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_basics.html">Class 基础(basics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime_troubles.html">运行时的注解问题(Annotation issues)</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">协议(Protocol)与结构化子类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_typing.html">动态类型代码(Dynamically)</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_narrowing.html">类型缩小(narrowing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="duck_type_compatibility.html">鸭子类型兼容性</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubs.html">存根文件(Stub)</a></li>
<li class="toctree-l1"><a class="reference internal" href="generics.html">泛型(Generics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_types.html">更多类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="literal_types.html">字面量类型(Literal types)和枚举(Enums)</a></li>
<li class="toctree-l1"><a class="reference internal" href="typed_dict.html">TypedDict</a></li>
<li class="toctree-l1"><a class="reference internal" href="final_attrs.html">最终名称, 方法和类(Final)</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaclasses.html">元类(Metaclasses)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">配置和运行 mypy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="running_mypy.html">运行 mypy 和管理导入(imports)</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">mypy命令行(command line)</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_file.html">mypy 配置文件(mypy configuration file)</a></li>
<li class="toctree-l1"><a class="reference internal" href="inline_config.html">内联配置(Inline configuration)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mypy_daemon.html">Mypy 守护进程 (mypy 服务)</a></li>
<li class="toctree-l1"><a class="reference internal" href="installed_packages.html">使用已安装的包(Using installed packages)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending_mypy.html">扩展和集成 mypy(Extending and integrating mypy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubgen.html">自动存根生成(Automatic stub generation) (stubgen)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubtest.html">自动化存根测试(Automatic stub testing)(stubtest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common_issues.html">常见问题及解决方案(Common issues and solutions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_python_features.html">支持的 Python 特性(Supported Python features)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_codes.html">错误代码(Error codes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_code_list.html">默认启用的错误代码(Error codes enabled by default)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_code_list2.html">可选检查的错误代码(Error codes for optional checks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional_features.html">附加功能(Additional features)</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常见问题解答(Frequently Asked Questions)</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Mypy 版本说明</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">项目链接</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/python/mypy">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mypy-lang.org/">Website</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/python/mypy/blob/master/docs/source/changelog.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/python/mypy/edit/master/docs/source/changelog.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <!-- This file includes mypy/CHANGELOG.md into mypy documentation -->
<section id="mypy">
<h1>Mypy 版本说明<a class="headerlink" href="#mypy" title="Link to this heading">¶</a></h1>
<section id="id1">
<h2>下一个版本<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
</section>
<section id="mypy-1-12">
<h2>Mypy 1.12<a class="headerlink" href="#mypy-1-12" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.12 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。此版本包括新功能、性能改进和错误修复。你可以按照以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>你可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 阅读此版本的完整文档。</p>
<section id="python-3-12-pep-695">
<h3>支持 Python 3.12 的泛型语法（PEP 695）<a class="headerlink" href="#python-3-12-pep-695" title="Link to this heading">¶</a></h3>
<p>现在默认启用对 Python 3.12 中引入的新类型参数语法的支持，已记录在案，不再是实验性功能。在 mypy 1.11 中通过功能标志提供的实验性功能。</p>
<p>以下示例演示了新语法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 泛型函数</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 显示的类型是 &#39;int&#39;</span>

<span class="c1"># 泛型类</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># 显示的类型是 &#39;str&#39;</span>

<span class="c1"># 类型别名</span>
<span class="nb">type</span> <span class="n">A</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span>
</pre></div>
</div>
<p>有关更多信息，请参阅 <a class="reference external" href="https://mypy.readthedocs.io/en/latest/generics.html">文档</a>。</p>
<p>包括以下改进：</p>
<ul class="simple">
<li><p>记录 Python 3.12 类型参数语法（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17816">17816</a>）</p></li>
<li><p>进一步更新文档（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17826">17826</a>）</p></li>
<li><p>允许自我返回类型与逆变（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17786">17786</a>）</p></li>
<li><p>默认启用新类型参数语法（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17798">17798</a>）</p></li>
<li><p>如果新样式类型别名用作基类，则生成错误（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17789">17789</a>）</p></li>
<li><p>如果基类具有显式方差，则继承方差（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17787">17787</a>）</p></li>
<li><p>修复无效类型变量引用时的崩溃（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17788">17788</a>）</p></li>
<li><p>修复冻结数据类的协变（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17783">17783</a>）</p></li>
<li><p>允许以“<code class="docutils literal notranslate"><span class="pre">_</span></code>”命名前缀的属性的协变（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17782">17782</a>）</p></li>
<li><p>在新样式类型别名中支持 <code class="docutils literal notranslate"><span class="pre">Annotated[...]</span></code>（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17777">17777</a>）</p></li>
<li><p>修复嵌套的泛型类（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17776">17776</a>）</p></li>
<li><p>增加对类型参数和类型别名作用域内不正确表达式使用的检测和错误报告（Kirill Podoprigora，PR <a class="reference external" href="https://github.com/python/mypy/pull/17560">17560</a>）</p></li>
</ul>
</section>
<section id="python-3-13">
<h3>对 Python 3.13 的基本支持<a class="headerlink" href="#python-3-13" title="Link to this heading">¶</a></h3>
<p>此版本增加了对 Python 3.13 特性的部分支持，并提供了 Python 3.13 的编译二进制文件。Mypyc 现在也支持 Python 3.13。</p>
<p>特别地，支持以下特性：</p>
<ul class="simple">
<li><p>各种新的标准库特性和变更（通过 typeshed 存根改进）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code>（详见下文）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">typing.TypeIs</span></code>（在 mypy 1.10 中添加，<a class="reference external" href="https://peps.python.org/pep-0742/">PEP 742</a>）</p></li>
<li><p>使用遗留语法时的类型参数默认值（<a class="reference external" href="https://peps.python.org/pep-0696/">PEP 696</a>）</p></li>
</ul>
<p>尚不支持以下特性：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">warnings.deprecated</span></code>（<a class="reference external" href="https://peps.python.org/pep-0702/">PEP 702</a>）</p></li>
<li><p>使用 Python 3.12 类型参数语法时的类型参数默认值</p></li>
</ul>
</section>
<section id="mypyc-python-3-13">
<h3>Mypyc 对 Python 3.13 的支持<a class="headerlink" href="#mypyc-python-3-13" title="Link to this heading">¶</a></h3>
<p>Mypyc 现在支持 Python 3.13。这是由 Marc Mueller 提供的，并由 Jukka Lehtosalo 进行了额外修复。尚不支持自由线程的 Python 3.13 构建。</p>
<p>更改列表：</p>
<ul class="simple">
<li><p>为 Python 3.13 添加额外包含（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17506">17506</a>）</p></li>
<li><p>为 Python 3.13 添加另一个包含（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17509">17509</a>）</p></li>
<li><p>修复 Python 3.13 的 ManagedDict 函数（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17507">17507</a>）</p></li>
<li><p>更新 Python 3.13 的 mypyc 测试输出（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17508">17508</a>）</p></li>
<li><p>修复 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">PyUnicode</span></code> 函数（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17504">17504</a>）</p></li>
<li><p>修复 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">_PyObject_LookupAttrId</span></code>（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17505">17505</a>）</p></li>
<li><p>修复 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">_PyList_Extend</span></code>（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17503">17503</a>）</p></li>
<li><p>修复 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">gen_is_coroutine</span></code>（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17501">17501</a>）</p></li>
<li><p>修复 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">_PyObject_FastCall</span></code>（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/17502">17502</a>）</p></li>
<li><p>避免在 3.13 上使用 <code class="docutils literal notranslate"><span class="pre">_PyObject_CallMethodOneArg</span></code>（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17526">17526</a>）</p></li>
<li><p>不再依赖 3.13 上的 <code class="docutils literal notranslate"><span class="pre">_PyType_CalculateMetaclass</span></code>（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17525">17525</a>）</p></li>
<li><p>不在 3.13 上使用 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_FastCopyCharacters</span></code>（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17524">17524</a>）</p></li>
<li><p>不在 3.13 上使用 <code class="docutils literal notranslate"><span class="pre">_PyUnicode_EQ</span></code>，因为它不再导出（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17523">17523</a>）</p></li>
</ul>
</section>
<section id="id2">
<h3>推断条件表达式的联合类型<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>Mypy 现在总是尝试推断条件表达式的联合类型，如果左右操作数类型不同。这导致推断类型更加精确，并使 mypy 能够检测到更多问题。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span> <span class="k">if</span> <span class="n">cond</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span>
<span class="c1"># &quot;s&quot; 的类型现在是 &quot;str | int&quot;（之前是 &quot;object&quot;）</span>
</pre></div>
</div>
<p>值得注意的是，如果其中一个操作数的类型是 <code class="docutils literal notranslate"><span class="pre">Any</span></code>，则条件表达式的类型现在是 <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span> <span class="pre">|</span> <span class="pre">Any</span></code>。以前推断的类型只是 <code class="docutils literal notranslate"><span class="pre">Any</span></code>。新类型基本上表示该值可以是 <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> 类型，也可能是某种（未知）类型。对结果进行的大多数操作也必须对 <code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code> 有效。相关示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">a</span> <span class="k">if</span> <span class="n">b</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="c1"># x 的类型是 &quot;Any | None&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># 错误：None 没有属性 &quot;y&quot;</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/17427">17427</a>）。</p>
</section>
<section id="typeddict-readonly-pep-705">
<h3>对 TypedDict 的 ReadOnly 支持 (PEP 705)<a class="headerlink" href="#typeddict-readonly-pep-705" title="Link to this heading">¶</a></h3>
<p>现在可以使用 <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> 将 TypedDict 项目指定为只读 (<a class="reference external" href="https://peps.python.org/pep-0705">PEP 705</a>)：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="c1"># 或在 Python 3.13 上使用 &quot;from typing ...&quot;</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">ReadOnly</span>

<span class="k">class</span> <span class="nc">TD</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="n">d</span><span class="p">:</span> <span class="n">TD</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">d</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 正确</span>
<span class="n">d</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 错误：“b”是只读的</span>
</pre></div>
</div>
<p>此功能由 Nikita Sobolev 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/17644">17644</a>）。</p>
</section>
<section id="python-3-8">
<h3>Python 3.8 结束支持在即<a class="headerlink" href="#python-3-8" title="Link to this heading">¶</a></h3>
<p>我们计划在下一个 mypy 功能发布或随后的版本中放弃对 Python 3.8 的支持。Python 3.8 将于 2024 年 10 月结束支持。</p>
</section>
<section id="id3">
<h3>默认设置的计划更改<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<p>我们计划在 mypy 2.0 中默认启用 <code class="docutils literal notranslate"><span class="pre">--local-partial-types</span></code>。这通常需要至少进行小幅代码更改。该选项在 mypy 守护进程中隐式启用，从而使守护进程和非守护进程模式的行为一致。</p>
<p>我们建议 mypy 用户尽快开始使用本地部分类型（或明确禁用它们）以为这一变化做好准备。</p>
<p>这也可以在 mypy 配置文件中进行配置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">local_partial_types</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>有关更多信息，请参阅 <a class="reference external" href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-local-partial-types">文档</a>。</p>
</section>
<section id="id4">
<h3>文档更新<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p>Mypy 文档现在在许多示例中使用现代语法变体和导入。一些示例在 Python 3.8 上不再有效，这是 mypy 支持的最早 Python 版本。</p>
<p>值得注意的是，<code class="docutils literal notranslate"><span class="pre">Iterable</span></code> 和其他协议/抽象基类从 <code class="docutils literal notranslate"><span class="pre">collections.abc</span></code> 导入，而不是 <code class="docutils literal notranslate"><span class="pre">typing</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Callable</span>
</pre></div>
</div>
<p>示例还避免使用内置类型的大写别名：使用 <code class="docutils literal notranslate"><span class="pre">list[str]</span></code> 代替 <code class="docutils literal notranslate"><span class="pre">List[str]</span></code>。在 Python 3.10 中引入的 <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">|</span> <span class="pre">Y</span></code> 联合类型语法现在也很普遍。</p>
<p>文档更新列表：</p>
<ul class="simple">
<li><p>记录 <code class="docutils literal notranslate"><span class="pre">--output=json</span></code> CLI 选项（Edgar Ramírez Mondragón，PR <a class="reference external" href="https://github.com/python/mypy/pull/17611">17611</a>）</p></li>
<li><p>更新文档中对弃用类型别名的各种引用（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17829">17829</a>）</p></li>
<li><p>在文档中强调 &quot;X | Y&quot; 联合语法（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17835">17835</a>）</p></li>
<li><p>在文档中讨论自类型之前的上限（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17827">17827</a>）</p></li>
<li><p>在 mypy 文档中显示变更日志（quinn-sasha，PR <a class="reference external" href="https://github.com/python/mypy/pull/17742">17742</a>）</p></li>
<li><p>列出 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature</span></code> 文档中的所有不完整特性（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17633">17633</a>）</p></li>
<li><p>移除对 pygments 主题的显式设置（Pradyun Gedam，PR <a class="reference external" href="https://github.com/python/mypy/pull/17571">17571</a>）</p></li>
<li><p>使用 TypedDict 文档化 ReadOnly（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17905">17905</a>）</p></li>
<li><p>文档化 TypeIs（Chelsea Durazo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17821">17821</a>）</p></li>
</ul>
</section>
<section id="typeddict">
<h3>实验性内联 TypedDict 语法<a class="headerlink" href="#typeddict" title="Link to this heading">¶</a></h3>
<p>Mypy 现在支持一种非标准的实验性语法，用于定义匿名 TypedDict。示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">}:</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">}</span>
</pre></div>
</div>
<p>该功能默认禁用。使用 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature=InlineTypedDict</span></code> 来启用它。<em>我们可能在未来的版本中移除此功能。</em></p>
<p>该功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/17457">17457</a>）。</p>
</section>
<section id="stubgen">
<h3>Stubgen 改进<a class="headerlink" href="#stubgen" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复了在字面量类级关键字上的崩溃（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17663">17663</a>）</p></li>
<li><p>Stubgen 添加 <code class="docutils literal notranslate"><span class="pre">--version</span></code> 选项（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17662">17662</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">stubgen</span> <span class="pre">--no-analysis/--parse-only</span></code> 文档（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17632">17632</a>）</p></li>
<li><p>在 stubgenc 中生成签名时包含关键字参数（Eric Mark Martin，PR <a class="reference external" href="https://github.com/python/mypy/pull/17448">17448</a>）</p></li>
<li><p>添加支持从文档字符串提取类型时检测 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 类型（Michael Carlstrom，PR <a class="reference external" href="https://github.com/python/mypy/pull/17441">17441</a>）</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">Generator</span></code> 类型变量的默认值（Sebastian Rittau，PR <a class="reference external" href="https://github.com/python/mypy/pull/17670">17670</a>）</p></li>
</ul>
</section>
<section id="stubtest">
<h3>Stubtest 改进<a class="headerlink" href="#stubtest" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>添加对 <code class="docutils literal notranslate"><span class="pre">cached_property</span></code> 的支持（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/17626">17626</a>）</p></li>
<li><p>向 <code class="docutils literal notranslate"><span class="pre">stubtest</span></code> 添加 <code class="docutils literal notranslate"><span class="pre">enable_incomplete_feature</span></code> 验证（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17635">17635</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">stubtest</span></code> 在使用 <code class="docutils literal notranslate"><span class="pre">--mypy-config-file</span></code> 时的错误代码处理（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17629">17629</a>）</p></li>
</ul>
</section>
<section id="id5">
<h3>其他显著修复和改进<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>使用不支持的类型参数默认值时报告错误（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17876">17876</a>）</p></li>
<li><p>修复当节点类型变化时，mypy 守护进程重新处理交叉引用的问题（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17883">17883</a>）</p></li>
<li><p>不要在值为 IntEnum/StrEnum 时使用相等性来缩小类型（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17866">17866</a>）</p></li>
<li><p>不将 None 与 IntEnum 的比较视为模糊（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17877">17877</a>）</p></li>
<li><p>修复 IntEnum 和 StrEnum 类型的缩小（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17874">17874</a>）</p></li>
<li><p>在类型推断过程中根据自类型过滤重载项（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17873">17873</a>）</p></li>
<li><p>启用联合 TypeVar 上限的负缩小（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17850">17850</a>）</p></li>
<li><p>修复成员表达式格式化的问题（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17848">17848</a>）</p></li>
<li><p>避免在扩展类型时类型大小爆炸（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17842">17842</a>）</p></li>
<li><p>修复在匹配语句中元组的负缩小问题（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17817">17817</a>）</p></li>
<li><p>将假值的 str/bytes/int 缩小为字面量类型（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17818">17818</a>）</p></li>
<li><p>针对最新的 Python 3.13 进行测试，使得 3.14 的测试变得简单（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17812">17812</a>）</p></li>
<li><p>拒绝参数规格类型的可调用对象调用中参数不足的情况（Stanislav Terliakov，PR <a class="reference external" href="https://github.com/python/mypy/pull/17323">17323</a>）</p></li>
<li><p>修复在向接受单个 ParamSpec 的泛型基类传递过多类型参数时的崩溃（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17770">17770</a>）</p></li>
<li><p>修复 TypeVar 上限有时未显示在漂亮可调用对象中的问题（Brian Schubert，PR <a class="reference external" href="https://github.com/python/mypy/pull/17802">17802</a>）</p></li>
<li><p>为重叠函数签名添加错误代码（Katrina Connors，PR <a class="reference external" href="https://github.com/python/mypy/pull/17597">17597</a>）</p></li>
<li><p>检查 <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">...</span></code> 一元表达式中的 <code class="docutils literal notranslate"><span class="pre">truthy-bool</span></code>（sobolevn，PR <a class="reference external" href="https://github.com/python/mypy/pull/17773">17773</a>）</p></li>
<li><p>添加缺失的 lines-covered 和 lines-valid 属性（Soubhik Kumar Mitra，PR <a class="reference external" href="https://github.com/python/mypy/pull/17738">17738</a>）</p></li>
<li><p>修复递归元组类型的另一个崩溃场景（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17708">17708</a>）</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 中解析 TypeVar 上限（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17660">17660</a>）</p></li>
<li><p>在检查延迟节点时始终重置绑定器（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17643">17643</a>）</p></li>
<li><p>修复在单个解包时调用属性导致的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17641">17641</a>）</p></li>
<li><p>修复检查器插件 API 与实现之间的签名不匹配（bzoracler，PR <a class="reference external" href="https://github.com/python/mypy/pull/17343">17343</a>）</p></li>
<li><p>索引类型也会生成 GenericAlias（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17546">17546</a>）</p></li>
<li><p>修复可调用协议中的自类型崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17499">17499</a>）</p></li>
<li><p>修复带方法的 NamedTuple 和函数中的错误（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17498">17498</a>）</p></li>
<li><p>在 3.13 中为数据类添加 <code class="docutils literal notranslate"><span class="pre">__replace__</span></code>（Max Muoto，PR <a class="reference external" href="https://github.com/python/mypy/pull/17469">17469</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">--no-namespace-packages</span></code> 的帮助信息（Raphael Krupinski，PR <a class="reference external" href="https://github.com/python/mypy/pull/17472">17472</a>）</p></li>
<li><p>修复异步生成器的类型检查（Danny Yang，PR <a class="reference external" href="https://github.com/python/mypy/pull/17452">17452</a>）</p></li>
<li><p>修复 attrs 插件中的严格可选处理（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17451">17451</a>）</p></li>
<li><p>允许在泛型中混合 ParamSpec 和 TypeVarTuple（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17450">17450</a>）</p></li>
<li><p>改进类型的 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code>（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17898">17898</a>）</p></li>
<li><p>使 ReadOnly TypedDict 项目具有协变性（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17904">17904</a>）</p></li>
<li><p>修复与 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 相关的联合可调用对象（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17903">17903</a>）</p></li>
<li><p>改进与 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 相关的泛型函数处理（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17925">17925</a>）</p></li>
</ul>
</section>
<section id="mypy-1-12-1">
<h3>Mypy 1.12.1<a class="headerlink" href="#mypy-1-12-1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复在错误消息中显示部分已分析类型时的崩溃问题（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/17961">17961</a>）</p></li>
<li><p>修复在迭代联合类型时涉及 <code class="docutils literal notranslate"><span class="pre">self</span></code> 类型的问题（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17976">17976</a>）</p></li>
<li><p>修复联合类型上下文中带有类型变量默认值的类型对象问题（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/17991">17991</a>）</p></li>
<li><p>回退对 <code class="docutils literal notranslate"><span class="pre">os.path</span></code> 存根的更改，该更改影响了 <code class="docutils literal notranslate"><span class="pre">os.PathLike[Any]</span></code> 的使用（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/17995">17995</a>）</p></li>
</ul>
</section>
<section id="id6">
<h3>类型仓库更新<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>请查看 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=91a58b07cdd807b1d965e04ba85af2adab8bf924+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 以获取标准库类型仓库 stub 变化的完整列表。</p>
</section>
<section id="id7">
<h3>致谢<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Ali Hamdan</p></li>
<li><p>Anders Kaseorg</p></li>
<li><p>Bénédikt Tran</p></li>
<li><p>Brian Schubert</p></li>
<li><p>bzoracler</p></li>
<li><p>Chelsea Durazo</p></li>
<li><p>Danny Yang</p></li>
<li><p>Edgar Ramírez Mondragón</p></li>
<li><p>Eric Mark Martin</p></li>
<li><p>InSync</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jordandev678</p></li>
<li><p>Katrina Connors</p></li>
<li><p>Kirill Podoprigora</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Max Muoto</p></li>
<li><p>Max Murin</p></li>
<li><p>Michael Carlstrom</p></li>
<li><p>Michael I Chen</p></li>
<li><p>Pradyun Gedam</p></li>
<li><p>quinn-sasha</p></li>
<li><p>Raphael Krupinski</p></li>
<li><p>Sebastian Rittau</p></li>
<li><p>Shantanu</p></li>
<li><p>sobolevn</p></li>
<li><p>Soubhik Kumar Mitra</p></li>
<li><p>Stanislav Terliakov</p></li>
<li><p>wyattscarpenter</p></li>
</ul>
<p>我还想感谢我的雇主，Dropbox，支持 mypy 的开发。</p>
</section>
</section>
<section id="mypy-1-11">
<h2>Mypy 1.11<a class="headerlink" href="#mypy-1-11" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.11 上传到 Python 包索引 (<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>)。Mypy 是一个 Python 的静态类型检查器。本次发布包含新功能、性能改进和错误修复。您可以通过以下方式安装：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3 -m pip install -U mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读本次发布的完整文档。</p>
<section id="id8">
<h3>支持 Python 3.12 的泛型语法（PEP 695）<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>Mypy 现在支持 Python 3.12 中引入的新类型参数语法 (<a class="reference external" href="https://peps.python.org/pep-0695/">PEP 695</a>)。此功能仍为实验性，必须通过 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature=NewGenericSyntax</span></code> 标志启用，或在 mypy 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">enable_incomplete_feature</span> <span class="pre">=</span> <span class="pre">NewGenericSyntax</span></code>。我们计划在下一个 mypy 功能发布中默认启用此功能。</p>
<p>以下示例演示了新语法：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 泛型函数</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># 显示的类型为 &#39;int&#39;</span>

<span class="c1"># 泛型类</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># 显示的类型为 &#39;str&#39;</span>

<span class="c1"># 类型别名</span>
<span class="nb">type</span> <span class="n">A</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]]</span>
</pre></div>
</div>
<p>该功能由 Jukka Lehtosalo 贡献。</p>
</section>
<section id="functools-partial">
<h3>支持 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code><a class="headerlink" href="#functools-partial" title="Link to this heading">¶</a></h3>
<p>Mypy 现在对 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code> 的使用进行类型检查。之前 mypy 会接受任意参数。</p>
<p>以下示例现在会产生错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># 参数的类型不兼容 &quot;int&quot;; 预期为 &quot;str&quot;</span>
<span class="n">g</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
</pre></div>
</div>
<p>该功能由 Shantanu 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/16939">16939</a>）。</p>
</section>
<section id="id9">
<h3>对未类型化重写的更严格检查<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>过去的 mypy 版本没有检查未类型化方法与重写方法的兼容性，这可能导致错误的否定。现在，当使用 <code class="docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code> 时，mypy 会执行这些检查。</p>
<p>例如，使用 <code class="docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code> 时，以下代码会生成错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># 签名与 &quot;Base&quot; 不兼容</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<p>该功能由 Steven Troxler 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/17276">17276</a>）。</p>
</section>
<section id="id10">
<h3>类型推断的改进<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<p>在 mypy 1.5 中引入的新多态推断算法现在在更多场景中使用，特别是涉及泛型高阶函数时，改进了类型推断。</p>
<p>该功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/17348">17348</a>）。</p>
<p>Mypy 现在在某些上下文中使用元组项类型的联合，以启用更精确的推断类型。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">):</span>
    <span class="c1"># 之前推断为 &#39;object&#39;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># 显示的类型为 &#39;int | str&#39;</span>
</pre></div>
</div>
<p>此功能同样由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/17408">17408</a>）。</p>
</section>
<section id="id11">
<h3>重载重叠检测的改进<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<p>mypy 检查两个 <code class="docutils literal notranslate"><span class="pre">&#64;overload</span></code> 签名是否不安全重叠的细节经过彻底重构。这不仅修复了一些误报，还允许 mypy 检测到额外的不安全签名。</p>
<p>该功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/17392">17392</a>）。</p>
</section>
<section id="id12">
<h3>更好的表达式中的类型提示支持<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p>Mypy 现在允许更多在所有表达式上下文中评估为有效类型注释的表达式。这些表达式的推断类型有时也更精确，之前通常为 <code class="docutils literal notranslate"><span class="pre">object</span></code>。</p>
<p>以下示例使用包含可调用类型的联合类型作为表达式，现在不再生成错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Callable</span><span class="p">[[],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># 无错误</span>
</pre></div>
</div>
<p>该功能由 Jukka Lehtosalo 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/17404">17404</a>）。</p>
</section>
<section id="mypyc">
<h3>Mypyc 改进<a class="headerlink" href="#mypyc" title="Link to this heading">¶</a></h3>
<p>Mypyc 现在支持在 Python 3.12 中引入的新泛型语法（见上文）。另一个显著的改进是对 <code class="docutils literal notranslate"><span class="pre">int</span></code> 值的基本操作显著加快。</p>
<ul class="simple">
<li><p>支持 Python 3.12 泛型函数和类的语法（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17357">17357</a>）</p></li>
<li><p>支持 Python 3.12 类型别名语法（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17384">17384</a>）</p></li>
<li><p>修复 ParamSpec（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17309">17309</a>）</p></li>
<li><p>内联整数解包操作的快速路径（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17266">17266</a>）</p></li>
<li><p>内联标记整数的算术和位操作（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17265">17265</a>）</p></li>
<li><p>允许将原始类型指定为纯（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17263">17263</a>）</p></li>
</ul>
</section>
<section id="id13">
<h3>Stubtest 的更改<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>忽略 <code class="docutils literal notranslate"><span class="pre">_ios_support</span></code>（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/17270">17270</a>）</p></li>
<li><p>改进对 Python 3.13 的支持（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17261">17261</a>）</p></li>
</ul>
</section>
<section id="id14">
<h3>Stubgen 的更改<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>优雅处理无效的 <code class="docutils literal notranslate"><span class="pre">Optional</span></code> 并识别 PEP 604 联合的别名（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/17386">17386</a>）</p></li>
<li><p>修复 Python 3.13（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/17290">17290</a>）</p></li>
<li><p>保留枚举值初始化器（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17125">17125</a>）</p></li>
</ul>
</section>
<section id="id15">
<h3>杂项新功能<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>通过 <code class="docutils literal notranslate"><span class="pre">--output</span> <span class="pre">json</span></code> 添加错误格式支持和 JSON 输出选项（Tushar Sadhwani, PR <a class="reference external" href="https://github.com/python/mypy/pull/11396">11396</a>）</p></li>
<li><p>支持 Python 3.11+ 中的 <code class="docutils literal notranslate"><span class="pre">enum.member</span></code>（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/17382">17382</a>）</p></li>
<li><p>支持 Python 3.11+ 中的 <code class="docutils literal notranslate"><span class="pre">enum.nonmember</span></code>（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/17376">17376</a>）</p></li>
<li><p>支持 Python 3.13 中的 <code class="docutils literal notranslate"><span class="pre">namedtuple.__replace__</span></code>（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17259">17259</a>）</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">collections.namedtuple</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">rename=True</span></code>（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/17247">17247</a>）</p></li>
<li><p>添加对 <code class="docutils literal notranslate"><span class="pre">__spec__</span></code> 的支持（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/14739">14739</a>）</p></li>
</ul>
</section>
<section id="id16">
<h3>错误报告的更改<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在消息中提及 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature=NewGenericSyntax</span></code>（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17462">17462</a>）</p></li>
<li><p>不报告插件生成的方法与 <code class="docutils literal notranslate"><span class="pre">explicit-override</span></code>（sobolevn, PR <a class="reference external" href="https://github.com/python/mypy/pull/17433">17433</a>）</p></li>
<li><p>对函数类型变量使用和显示命名空间（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17311">17311</a>）</p></li>
<li><p>修复协议中对 Final 本地作用域变量的误报（GiorgosPapoutsakis, PR <a class="reference external" href="https://github.com/python/mypy/pull/17308">17308</a>）</p></li>
<li><p>在更多消息中使用 Never，并在连接时使用 ambiguous（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17304">17304</a>）</p></li>
<li><p>在详细输出中记录配置文件的完整路径（dexterkennedy, PR <a class="reference external" href="https://github.com/python/mypy/pull/17180">17180</a>）</p></li>
<li><p>为不支持的属性装饰器添加 <code class="docutils literal notranslate"><span class="pre">[prop-decorator]</span></code> 代码（Christopher Barber, PR <a class="reference external" href="https://github.com/python/mypy/pull/16571">16571</a>）</p></li>
<li><p>对使用 <code class="docutils literal notranslate"><span class="pre">:=</span></code> 和 <code class="docutils literal notranslate"><span class="pre">[truthy-bool]</span></code> 的第二个错误消息进行抑制（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15941">15941</a>）</p></li>
<li><p>为将功能 Enum 分配给不同名称的变量生成错误（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16805">16805</a>）</p></li>
<li><p>修复第三方库卸载后的缓存运行错误报告（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17420">17420</a>）</p></li>
</ul>
</section>
<section id="id17">
<h3>崩溃修复<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复 TypedDict 中无效类型的守护进程崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17495">17495</a>）</p></li>
<li><p>修复与 <code class="docutils literal notranslate"><span class="pre">partial()</span></code> 相关的崩溃和错误（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17423">17423</a>）</p></li>
<li><p>修复解包 TypedDict 时的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17359">17359</a>）</p></li>
<li><p>修复 ParamSpec 解包 TypedDict 时的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17358">17358</a>）</p></li>
<li><p>修复涉及元组的递归联合时的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17353">17353</a>）</p></li>
<li><p>修复无效可调用属性重写时的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17352">17352</a>）</p></li>
<li><p>修复在 NamedTuple 中解包 self 时的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17351">17351</a>）</p></li>
<li><p>修复带有可选类型的递归别名崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17350">17350</a>）</p></li>
<li><p>修复在泛型定义内的类型注释崩溃（Bénédikt Tran, PR <a class="reference external" href="https://github.com/python/mypy/pull/16849">16849</a>）</p></li>
</ul>
</section>
<section id="id18">
<h3>文档更改<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在文档中对可选错误代码使用内联配置（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17374">17374</a>）</p></li>
<li><p>在文档中使用小写泛型（Seo Sanghyeon, PR <a class="reference external" href="https://github.com/python/mypy/pull/17176">17176</a>）</p></li>
<li><p>添加 show-error-code-links 的文档（GiorgosPapoutsakis, PR <a class="reference external" href="https://github.com/python/mypy/pull/17144">17144</a>）</p></li>
<li><p>更新 CONTRIBUTING.md 以包含 Windows 命令（GiorgosPapoutsakis, PR <a class="reference external" href="https://github.com/python/mypy/pull/17142">17142</a>）</p></li>
</ul>
</section>
<section id="id19">
<h3>其他显著改进和修复<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复对 TypeVarTuple 的 ParamSpec 推断（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17431">17431</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">partial</span></code> 的显式类型（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17424">17424</a>）</p></li>
<li><p>始终允许 lambda 调用（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17430">17430</a>）</p></li>
<li><p>修复包含 None 的 PEP 604 联合类型的 isinstance 检查（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17415">17415</a>）</p></li>
<li><p>修复新样式类型变量中的自引用上限（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17407">17407</a>）</p></li>
<li><p>考虑实例与可调用对象之间的重叠（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17389">17389</a>）</p></li>
<li><p>允许在类方法中使用新样式的 self 类型（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17381">17381</a>）</p></li>
<li><p>修复对 PEP 604 联合类型的类型别名进行 isinstance 检查（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17371">17371</a>）</p></li>
<li><p>在重叠检查中正确处理解包（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17356">17356</a>）</p></li>
<li><p>修复具有泛型构造函数的类的类型应用（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17354">17354</a>）</p></li>
<li><p>更新 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 至 &gt;=4.6.0 以修复 Python 3.12 错误（Ben Brown, PR <a class="reference external" href="https://github.com/python/mypy/pull/17312">17312</a>）</p></li>
<li><p>避免在 lambda 中出现 &quot;does not return&quot; 错误（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17294">17294</a>）</p></li>
<li><p>修复在非严格可选模式下与描述符相关的错误（Max Murin, PR <a class="reference external" href="https://github.com/python/mypy/pull/17293">17293</a>）</p></li>
<li><p>不要将 lambda 体内的不可达性泄露到周围作用域（Anders Kaseorg, PR <a class="reference external" href="https://github.com/python/mypy/pull/17287">17287</a>）</p></li>
<li><p>修复 Windows 上非 ASCII 字符的问题（Alexander Leopold Shon, PR <a class="reference external" href="https://github.com/python/mypy/pull/17275">17275</a>）</p></li>
<li><p>修复负整数字面量的类型缩小问题（gilesgc, PR <a class="reference external" href="https://github.com/python/mypy/pull/17256">17256</a>）</p></li>
<li><p>修复 mypy 守护进程中 .py 和 .pyi 文件之间的混淆（Valentin Stanciu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17245">17245</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">tuple[X,</span> <span class="pre">Y]</span></code> 表达式的类型（urnest, PR <a class="reference external" href="https://github.com/python/mypy/pull/17235">17235</a>）</p></li>
<li><p>不要忘记在发生 <code class="docutils literal notranslate"><span class="pre">name-defined</span></code> 错误后，<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 被包裹在 <code class="docutils literal notranslate"><span class="pre">Unpack</span></code> 中（Christoph Tyralla, PR <a class="reference external" href="https://github.com/python/mypy/pull/17226">17226</a>）</p></li>
<li><p>将注解参数标记为具有显式类型，而非推断类型（bzoracler, PR <a class="reference external" href="https://github.com/python/mypy/pull/17217">17217</a>）</p></li>
<li><p>不要将 Enum 私有属性视为枚举成员（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/17182">17182</a>）</p></li>
<li><p>修复包含管道字符的字面量字符串（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/17148">17148</a>）</p></li>
</ul>
</section>
<section id="typeshed">
<h3>Typeshed 更新<a class="headerlink" href="#typeshed" title="Link to this heading">¶</a></h3>
<p>请查看 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=6dda799d8ad1d89e0f8aad7ac41d2d34bd838ace+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 获取标准库 typeshed 存根更改的完整列表。</p>
</section>
<section id="mypy-1-11-1">
<h3>Mypy 1.11.1<a class="headerlink" href="#mypy-1-11-1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">RawExpressionType.accept</span></code> 在 <code class="docutils literal notranslate"><span class="pre">--cache-fine-grained</span></code> 下崩溃（Anders Kaseorg, PR <a class="reference external" href="https://github.com/python/mypy/pull/17588">17588</a>）</p></li>
<li><p>修复 PEP 604 的 isinstance 缓存（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17563">17563</a>）</p></li>
<li><p>修复在 Python &lt; 3.12 上未定义的 <code class="docutils literal notranslate"><span class="pre">typing.TypeAliasType</span></code>（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/17558">17558</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">types.GenericAlias</span></code> 查找崩溃（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17543">17543</a>）</p></li>
</ul>
</section>
<section id="mypy-1-11-2">
<h3>Mypy 1.11.2<a class="headerlink" href="#mypy-1-11-2" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>联合类型字面量字符串的替代修复（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17639">17639</a>）</p></li>
<li><p>存储前解包 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 项类型（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/17640">17640</a>）</p></li>
</ul>
</section>
<section id="id20">
<h3>致谢<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h3>
<p>感谢所有为此版本贡献的 mypy 开发者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Alexander Leopold Shon</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Anders Kaseorg</p></li>
<li><p>Ben Brown</p></li>
<li><p>Bénédikt Tran</p></li>
<li><p>bzoracler</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>Christopher Barber</p></li>
<li><p>dexterkennedy</p></li>
<li><p>gilesgc</p></li>
<li><p>GiorgosPapoutsakis</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Matthieu Devlin</p></li>
<li><p>Michael R. Crusoe</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Seo Sanghyeon</p></li>
<li><p>Shantanu</p></li>
<li><p>sobolevn</p></li>
<li><p>Steven Troxler</p></li>
<li><p>Tadeu Manoel</p></li>
<li><p>Tamir Duberstein</p></li>
<li><p>Tushar Sadhwani</p></li>
<li><p>urnest</p></li>
<li><p>Valentin Stanciu</p></li>
</ul>
<p>同时也感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
</section>
</section>
<section id="mypy-1-10">
<h2>Mypy 1.10<a class="headerlink" href="#mypy-1-10" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.10 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是 Python 的静态类型检查器。本次发布包含新特性、性能改进和错误修复。您可以通过以下命令安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
<section id="typeis-pep-742">
<h3>支持 TypeIs (PEP 742)<a class="headerlink" href="#typeis-pep-742" title="Link to this heading">¶</a></h3>
<p>Mypy 现在支持 <code class="docutils literal notranslate"><span class="pre">TypeIs</span></code>（<a class="reference external" href="https://peps.python.org/pep-0742/">PEP 742</a>），允许函数缩小值的类型，类似于 <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>。与 <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code> 不同，<code class="docutils literal notranslate"><span class="pre">TypeIs</span></code> 可以在 if 语句的 <code class="docutils literal notranslate"><span class="pre">if</span></code> 和 <code class="docutils literal notranslate"><span class="pre">else</span></code> 分支中缩小类型：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeIs</span>

<span class="k">def</span> <span class="nf">is_str</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeIs</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_str</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
        <span class="c1"># o 的类型是 &#39;str&#39;</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># o 的类型是 &#39;int&#39;</span>
        <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TypeIs</span></code> 将在 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 模块中添加，但可以通过从 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 导入在早期 Python 版本中使用。</p>
<p>此功能由 Jelle Zijlstra 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/16898">16898</a>）。</p>
</section>
<section id="typevar-pep-696">
<h3>支持 TypeVar 默认值 (PEP 696)<a class="headerlink" href="#typevar-pep-696" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://peps.python.org/pep-0696/">PEP 696</a> 添加了对类型参数默认值的支持。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
   <span class="o">...</span>

<span class="n">x</span><span class="p">:</span> <span class="n">C</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">y</span><span class="p">:</span> <span class="n">C</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># C[int], 因为有默认值</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># C[str]</span>
</pre></div>
</div>
<p>TypeVar 默认值将被添加到 Python 3.13 的 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 模块中，但可以通过从 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 导入在早期 Python 版本中使用。</p>
<p>此功能由 Marc Mueller 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/16878">16878</a> 和 PR <a class="reference external" href="https://github.com/python/mypy/pull/16925">16925</a>）。</p>
</section>
<section id="typealiastype-pep-695">
<h3>支持 TypeAliasType (PEP 695)<a class="headerlink" href="#typealiastype-pep-695" title="Link to this heading">¶</a></h3>
<p>作为实现 <a class="reference external" href="https://peps.python.org/pep-0695/">PEP 695</a> 的初步步骤，mypy 现在支持 <code class="docutils literal notranslate"><span class="pre">TypeAliasType</span></code>。<code class="docutils literal notranslate"><span class="pre">TypeAliasType</span></code> 提供了 Python 3.12 中新 <code class="docutils literal notranslate"><span class="pre">type</span></code> 语句的回溯支持。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">ListOrSet</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>等价于：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">ListOrSet</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span><span class="s2">&quot;ListOrSet&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">type_params</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,))</span>
</pre></div>
</div>
<p>在 mypy 中使用的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeAliasType</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">NewUnionType</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span><span class="s2">&quot;NewUnionType&quot;</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
<span class="n">x</span><span class="p">:</span> <span class="n">NewUnionType</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">y</span><span class="p">:</span> <span class="n">NewUnionType</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
<span class="n">z</span><span class="p">:</span> <span class="n">NewUnionType</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>  <span class="c1"># 错误：赋值中类型不兼容（表达式的类型是 &quot;object&quot;，变量的类型是 &quot;int | str&quot;）[assignment]</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">ListOrSet</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span><span class="s2">&quot;ListOrSet&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">type_params</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,))</span>
<span class="n">a</span><span class="p">:</span> <span class="n">ListOrSet</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span><span class="p">:</span> <span class="n">ListOrSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">}</span>
<span class="n">c</span><span class="p">:</span> <span class="n">ListOrSet</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>  <span class="c1"># 错误：赋值中类型不兼容（表达式的类型是 &quot;str&quot;，变量的类型是 &quot;list[str] | set[str]&quot;）[assignment]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TypeAliasType</span></code> 已在 Python 3.12 的 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 模块中添加，但可以通过从 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 导入在早期 Python 版本中使用。</p>
<p>此功能由 Ali Hamdan 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/16926">16926</a>、PR <a class="reference external" href="https://github.com/python/mypy/pull/17038">17038</a> 和 PR <a class="reference external" href="https://github.com/python/mypy/pull/17053">17053</a>）。</p>
</section>
<section id="unsafe-super">
<h3>检测额外的 unsafe super() 使用<a class="headerlink" href="#unsafe-super" title="Link to this heading">¶</a></h3>
<p>当目标具有简单（空）主体时，mypy 将更一致地拒绝 unsafe 使用 <code class="docutils literal notranslate"><span class="pre">super()</span></code>。示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Proto</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">Proto</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">meth</span><span class="p">()</span>  <span class="c1"># 错误（不安全）</span>
</pre></div>
</div>
<p>此功能由 Shantanu 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/16756">16756</a>）。</p>
</section>
<section id="id21">
<h3>Stubgen 改进<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>保留空元组注释（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16907">16907</a>）</p></li>
<li><p>添加对 PEP 570 位置参数的支持（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16904">16904</a>）</p></li>
<li><p>用内置容器替换过时的类型别名（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16780">16780</a>）</p></li>
<li><p>修复生成的数据类 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 签名（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16906">16906</a>）</p></li>
</ul>
</section>
<section id="id22">
<h3>Mypyc 改进<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>提供更简单的 IR 到 IR 转换定义方式（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16998">16998</a>）</p></li>
<li><p>实现整数（不）相等的降低过程和添加原语（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17027">17027</a>）</p></li>
<li><p>实现剩余标记整数比较的降低（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17040">17040</a>）</p></li>
<li><p>优化一些布尔/比特寄存器（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17022">17022</a>）</p></li>
<li><p>重新标记由 async with 产生的重定义名称（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/16408">16408</a>）</p></li>
<li><p>优化运行时的 TYPE_CHECKING 为 False（Srinivas Lade, PR <a class="reference external" href="https://github.com/python/mypy/pull/16263">16263</a>）</p></li>
<li><p>修复不可达推导的编译（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/15721">15721</a>）</p></li>
<li><p>不在不可内联的最终局部读取时崩溃（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/15719">15719</a>）</p></li>
</ul>
</section>
<section id="id23">
<h3>文档改进<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>从 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 导入 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code>（Riccardo Di Maio, PR <a class="reference external" href="https://github.com/python/mypy/pull/16958">16958</a>）</p></li>
<li><p>在章节标题中添加缺失的 <code class="docutils literal notranslate"><span class="pre">mutable-override</span></code>（James Braza, PR <a class="reference external" href="https://github.com/python/mypy/pull/16886">16886</a>）</p></li>
</ul>
</section>
<section id="id24">
<h3>错误报告改进<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在错误消息中更一致地使用小写泛型（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/17035">17035</a>）</p></li>
</ul>
</section>
<section id="id25">
<h3>其他显著变化和修复<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复访问联合类型上的描述符时的错误推断类型（Matthieu Devlin, PR <a class="reference external" href="https://github.com/python/mypy/pull/16604">16604</a>）</p></li>
<li><p>修复在 <code class="docutils literal notranslate"><span class="pre">Callable</span></code> 别名中展开无效 <code class="docutils literal notranslate"><span class="pre">Unpack</span></code> 时崩溃（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/17028">17028</a>）</p></li>
<li><p>修复字符串格式化与字符串枚举时的误报（roberfi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16555">16555</a>）</p></li>
<li><p>匹配元组与序列模式时缩小单个项目（Loïc Simon, PR <a class="reference external" href="https://github.com/python/mypy/pull/16905">16905</a>）</p></li>
<li><p>修复 TypeGuard 或 TypeIs 中类型变量的误报（Evgeniy Slobodkin, PR <a class="reference external" href="https://github.com/python/mypy/pull/17071">17071</a>）</p></li>
<li><p>改进生成器的 <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 推断（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16717">16717</a>）</p></li>
<li><p>修复在 <code class="docutils literal notranslate"><span class="pre">attrs</span></code> 类中模拟哈希方法逻辑（Hashem, PR <a class="reference external" href="https://github.com/python/mypy/pull/17016">17016</a>）</p></li>
<li><p>添加使用 <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> 的 typeshed 回滚提交（Tamir Duberstein, PR <a class="reference external" href="https://github.com/python/mypy/pull/16942">16942</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">types.EllipsisType</span></code> 的类型缩小（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17003">17003</a>）</p></li>
<li><p>修复单项目枚举匹配类型耗尽（Oskari Lehto, PR <a class="reference external" href="https://github.com/python/mypy/pull/16966">16966</a>）</p></li>
<li><p>改进空集合的类型推断（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/16994">16994</a>）</p></li>
<li><p>修复装饰属性的覆盖检查（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16856">16856</a>）</p></li>
<li><p>修复与函数主题的匹配缩小（Edward Paget, PR <a class="reference external" href="https://github.com/python/mypy/pull/16503">16503</a>）</p></li>
<li><p>允许在 <code class="docutils literal notranslate"><span class="pre">Literal[...]</span></code> 中使用 <code class="docutils literal notranslate"><span class="pre">+N</span></code>（Spencer Brown, PR <a class="reference external" href="https://github.com/python/mypy/pull/16910">16910</a>）</p></li>
<li><p>实验性：在 <code class="docutils literal notranslate"><span class="pre">type[...]</span></code> 中支持 TypedDict（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/16963">16963</a>）</p></li>
<li><p>实验性：修复 <code class="docutils literal notranslate"><span class="pre">type[...]</span></code> 中具有可选键的 TypedDict 的问题（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/17068">17068</a>）</p></li>
</ul>
</section>
<section id="id26">
<h3>Typeshed 更新<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h3>
<p>有关标准库 typeshed 存根更改的完整列表，请参阅 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=6dda799d8ad1d89e0f8aad7ac41d2d34bd838ace+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a>。</p>
</section>
<section id="mypy-1-10-1">
<h3>Mypy 1.10.1<a class="headerlink" href="#mypy-1-10-1" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复卸载第三方库后缓存运行时的错误报告（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/17420">17420</a>）</p></li>
</ul>
</section>
<section id="id27">
<h3>感谢名单<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Edward Paget</p></li>
<li><p>Evgeniy Slobodkin</p></li>
<li><p>Hashem</p></li>
<li><p>hesam</p></li>
<li><p>Hugo van Kemenade</p></li>
<li><p>Ihor</p></li>
<li><p>James Braza</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>jhance</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Loïc Simon</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Matthieu Devlin</p></li>
<li><p>Michael R. Crusoe</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Oskari Lehto</p></li>
<li><p>Riccardo Di Maio</p></li>
<li><p>Richard Si</p></li>
<li><p>roberfi</p></li>
<li><p>Roman Solomatin</p></li>
<li><p>Sam Xifaras</p></li>
<li><p>Shantanu</p></li>
<li><p>Spencer Brown</p></li>
<li><p>Srinivas Lade</p></li>
<li><p>Tamir Duberstein</p></li>
<li><p>youkaichao</p></li>
</ul>
<p>我还想感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
</section>
</section>
<section id="mypy-1-9">
<h2>Mypy 1.9<a class="headerlink" href="#mypy-1-9" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.9 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。本次发布包括新特性、性能改进和错误修复。你可以按如下方式安装：</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3 -m pip install -U mypy
</pre></div>
</div>
<p>你可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读本次发布的完整文档。</p>
<section id="id28">
<h3>破坏性变更<a class="headerlink" href="#id28" title="Link to this heading">¶</a></h3>
<p>由于我们在 mypy 1.9 中使用的 typeshed 版本不支持 Python 3.7，因此 mypy 1.9 也不再支持该版本（Jared Hance, PR <a class="reference external" href="https://github.com/python/mypy/pull/16883">16883</a>）。</p>
<p>我们计划在今年晚些时候默认启用 <a class="reference external" href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-local-partial-types">局部部分类型</a>（通过 <code class="docutils literal notranslate"><span class="pre">--local-partial-types</span></code> 标志启用）。这个变化多年前就已宣布，现在终于要实施。这是一个重大不兼容的变更，因此我们可能会将其作为即将发布的 mypy 2.0 的一部分。这使得守护进程和非守护进程的 mypy 运行在默认情况下具有相同的行为。</p>
<p>局部部分类型也可以在 mypy 配置文件中启用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">local_partial_types</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>我们正在考虑提供一个工具，以便更容易地迁移项目使用 <code class="docutils literal notranslate"><span class="pre">--local-partial-types</span></code>，但目前尚不清楚这是否可行。迁移通常涉及为模块级和类级变量添加一些显式的类型注解。</p>
</section>
<section id="pep-696">
<h3>对类型参数默认值的基本支持（PEP 696）<a class="headerlink" href="#pep-696" title="Link to this heading">¶</a></h3>
<p>本次发布包含对类型参数默认值的新实验性支持（<a class="reference external" href="https://peps.python.org/pep-0696">PEP 696</a>）。请尝试一下！这个特性由 Marc Mueller 贡献。</p>
<p>由于此特性将在下一个 Python 特性版本（3.13）中正式引入，因此目前需要从 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 导入 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code>、<code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> 或 <code class="docutils literal notranslate"><span class="pre">TypeVarTuple</span></code> 来使用默认值。</p>
<p>下面是根据 PEP 修改的示例，定义了 <code class="docutils literal notranslate"><span class="pre">BotT</span></code> 的默认值：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="k">class</span> <span class="nc">Bot</span><span class="p">:</span> <span class="o">...</span>

<span class="n">BotT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;BotT&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Bot</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Bot</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Context</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">BotT</span><span class="p">]):</span>
    <span class="n">bot</span><span class="p">:</span> <span class="n">BotT</span>

<span class="k">class</span> <span class="nc">MyBot</span><span class="p">(</span><span class="n">Bot</span><span class="p">):</span> <span class="o">...</span>

<span class="c1"># 类型是 Bot（默认值）</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">Context</span><span class="p">()</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span>
<span class="c1"># 类型是 MyBot</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">Context</span><span class="p">[</span><span class="n">MyBot</span><span class="p">]()</span><span class="o">.</span><span class="n">bot</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id29">
<h3>类型检查改进<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复重载缺失类型存储的问题（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/16803">16803</a>）。</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">'WriteToConn'</span> <span class="pre">object</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">attribute</span> <span class="pre">'flush'</span></code> 错误（Charlie Denton, PR <a class="reference external" href="https://github.com/python/mypy/pull/16801">16801</a>）。</p></li>
<li><p>改进 TypeAlias 错误消息（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/16831">16831</a>）。</p></li>
<li><p>支持收窄包含 <code class="docutils literal notranslate"><span class="pre">type[None]</span></code> 的联合类型（Christoph Tyralla, PR <a class="reference external" href="https://github.com/python/mypy/pull/16315">16315</a>）。</p></li>
<li><p>支持将 TypedDict 作为类基类型的函数语法（anniel-stripe, PR <a class="reference external" href="https://github.com/python/mypy/pull/16703">16703</a>）。</p></li>
<li><p>接受多行引号注解（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16765">16765</a>）。</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 中允许一元加号（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/16729">16729</a>）。</p></li>
<li><p>替换静态方法返回类型中的类型变量（Kouroche Bouchiat, PR <a class="reference external" href="https://github.com/python/mypy/pull/16670">16670</a>）。</p></li>
<li><p>将 TypeVarTuple 视为不变（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/16759">16759</a>）。</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">attrs</span></code> 插件中的 <code class="docutils literal notranslate"><span class="pre">field()</span></code> 添加 <code class="docutils literal notranslate"><span class="pre">alias</span></code> 支持（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16610">16610</a>）。</p></li>
<li><p>改进 attrs 哈希检测（Tin Tvrtković, PR <a class="reference external" href="https://github.com/python/mypy/pull/16556">16556</a>）。</p></li>
</ul>
</section>
<section id="id30">
<h3>性能改进<a class="headerlink" href="#id30" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>加速查找函数类型变量（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16562">16562</a>）。</p></li>
</ul>
</section>
<section id="id31">
<h3>文档更新<a class="headerlink" href="#id31" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在 &quot;mypy --help&quot; 中记录 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature</span></code> 的支持值（Froger David, PR <a class="reference external" href="https://github.com/python/mypy/pull/16661">16661</a>）。</p></li>
<li><p>更新新类型系统讨论链接（thomaswhaley, PR <a class="reference external" href="https://github.com/python/mypy/pull/16841">16841</a>）。</p></li>
<li><p>在备忘单中添加缺失的类实例化（Aleksi Tarvainen, PR <a class="reference external" href="https://github.com/python/mypy/pull/16817">16817</a>）。</p></li>
<li><p>记录 <code class="docutils literal notranslate"><span class="pre">--no-strict-optional</span></code> 的潜在问题（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16731">16731</a>）。</p></li>
<li><p>改进 mypy 守护进程文档中关于局部部分类型的说明（Makonnen Makonnen, PR <a class="reference external" href="https://github.com/python/mypy/pull/16782">16782</a>）。</p></li>
<li><p>修正编号错误（Stefanie Molin, PR <a class="reference external" href="https://github.com/python/mypy/pull/16838">16838</a>）。</p></li>
<li><p>各种文档改进（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16836">16836</a>）。</p></li>
</ul>
</section>
<section id="id32">
<h3>Stubtest 改进<a class="headerlink" href="#id32" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>忽略缺失的私有函数/方法参数（私有参数名称以单下划线开头且具有默认值）（PR <a class="reference external" href="https://github.com/python/mypy/pull/16507">16507</a>）。</p></li>
<li><p>忽略新的协议 dunder（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/16895">16895</a>）。</p></li>
<li><p>可以省略私有参数（Sebastian Rittau, PR <a class="reference external" href="https://github.com/python/mypy/pull/16507">16507</a>）。</p></li>
<li><p>添加将枚举成员设置为 &quot;...&quot; 的支持（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/16807">16807</a>）。</p></li>
<li><p>调整符号表逻辑（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16823">16823</a>）。</p></li>
<li><p>修复重载解析中的位置参数处理（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16750">16750</a>）。</p></li>
</ul>
</section>
<section id="id33">
<h3>Stubgen 改进<a class="headerlink" href="#id33" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复 TypeVarTuple 的星号解包崩溃（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16869">16869</a>）。</p></li>
<li><p>在所有地方使用 PEP 604 联合（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16519">16519</a>）。</p></li>
<li><p>不忽略属性删除器（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16781">16781</a>）。</p></li>
<li><p>支持为 <code class="docutils literal notranslate"><span class="pre">staticmethod</span></code> 生成类型存根（WeilerMarcel, PR <a class="reference external" href="https://github.com/python/mypy/pull/14934">14934</a>）。</p></li>
</ul>
</section>
<section id="id34">
<h3>感谢致辞<a class="headerlink" href="#id34" title="Link to this heading">¶</a></h3>
<p>感谢所有为此版本贡献的 mypy 开发者：</p>
<ul class="simple">
<li><p>Aleksi Tarvainen</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>anniel-stripe</p></li>
<li><p>Charlie Denton</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>Dheeraj</p></li>
<li><p>Fabian Keller</p></li>
<li><p>Fabian Lewis</p></li>
<li><p>Froger David</p></li>
<li><p>Ihor</p></li>
<li><p>Jared Hance</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Kouroche Bouchiat</p></li>
<li><p>Lukas Geiger</p></li>
<li><p>Maarten Huijsmans</p></li>
<li><p>Makonnen Makonnen</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Sebastian Rittau</p></li>
<li><p>Shantanu</p></li>
<li><p>Stefanie Molin</p></li>
<li><p>Stephen Morton</p></li>
<li><p>thomaswhaley</p></li>
<li><p>Tin Tvrtković</p></li>
<li><p>WeilerMarcel</p></li>
<li><p>Wesley Collin Wright</p></li>
<li><p>zipperer</p></li>
</ul>
<p>也感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
</section>
</section>
<section id="mypy-1-8">
<h2>Mypy 1.8<a class="headerlink" href="#mypy-1-8" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.8 上传到 Python 包索引 (<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>)。mypy 是 Python 的静态类型检查器。此版本包含新功能、性能改进和错误修复。您可以通过以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
<section id="id35">
<h3>类型检查改进<a class="headerlink" href="#id35" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在 <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> 检查中，如果至少一个类型是 final，则不进行类型交集（Christoph Tyralla, PR <a class="reference external" href="https://github.com/python/mypy/pull/16330">16330</a>）。</p></li>
<li><p>检测到没有 <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> 的 <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> 类不能有假值实例（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/16566">16566</a>）。</p></li>
<li><p>不允许具有额外关键字的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16438">16438</a>）。</p></li>
<li><p>不允许 <code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> 的类级关键字（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16526">16526</a>）。</p></li>
<li><p>使不精确约束处理更健壮（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16502">16502</a>）。</p></li>
<li><p>修复扩展泛型 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 中的严格可选性（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16398">16398</a>）。</p></li>
<li><p>允许对 PEP 695 构造的类型忽略（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16608">16608</a>）。</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> 启用 <code class="docutils literal notranslate"><span class="pre">type_check_only</span></code> 支持（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16469">16469</a>）。</p></li>
</ul>
</section>
<section id="id36">
<h3>性能改进<a class="headerlink" href="#id36" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>增加分析特殊形式赋值的快速路径（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16561">16561</a>）。</p></li>
</ul>
</section>
<section id="id37">
<h3>错误报告改进<a class="headerlink" href="#id37" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>不显示插件错误代码的文档链接（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16383">16383</a>）。</p></li>
<li><p>改进 <code class="docutils literal notranslate"><span class="pre">super</span></code> 检查的错误消息并添加更多测试（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16393">16393</a>）。</p></li>
<li><p>为可变协变重写添加错误代码（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16399">16399</a>）。</p></li>
</ul>
</section>
<section id="id38">
<h3>Stubgen 改进<a class="headerlink" href="#id38" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在函数签名中保留简单默认值（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/15355">15355</a>）。</p></li>
<li><p>在输出中包含 <code class="docutils literal notranslate"><span class="pre">__all__</span></code>（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/16356">16356</a>）。</p></li>
<li><p>修复与 pybind11 和 mypy 1.7 的 stubgen 回归（Chad Dombrova, PR <a class="reference external" href="https://github.com/python/mypy/pull/16504">16504</a>）。</p></li>
</ul>
</section>
<section id="id39">
<h3>Stubtest 改进<a class="headerlink" href="#id39" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>改进不可表示默认值的处理（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/16433">16433</a>）。</p></li>
<li><p>如果缺少函数，打印更有帮助的错误信息（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/16517">16517</a>）。</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">&#64;type_check_only</span></code> 装饰器（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16422">16422</a>）。</p></li>
<li><p>警告缺少 <code class="docutils literal notranslate"><span class="pre">__del__</span></code>（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16456">16456</a>）。</p></li>
<li><p>修复某些使用 <code class="docutils literal notranslate"><span class="pre">final</span></code> 和 <code class="docutils literal notranslate"><span class="pre">deprecated</span></code> 的崩溃（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16457">16457</a>）。</p></li>
</ul>
</section>
<section id="id40">
<h3>崩溃修复<a class="headerlink" href="#id40" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复对 <code class="docutils literal notranslate"><span class="pre">Callable[[Unpack[Tuple[Any,</span> <span class="pre">...]]],</span> <span class="pre">Any]</span></code> 的类型别名导致的崩溃（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/16541">16541</a>）。</p></li>
<li><p>修复在 <code class="docutils literal notranslate"><span class="pre">__call__</span></code> 中的 TypeGuard 导致的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16516">16516</a>）。</p></li>
<li><p>修复方法中的无效枚举导致的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16511">16511</a>）。</p></li>
<li><p>修复 TypedDict 中未导入 Any 导致的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16510">16510</a>）。</p></li>
</ul>
</section>
<section id="id41">
<h3>文档更新<a class="headerlink" href="#id41" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>将软错误限制的默认值更新为 -1（Sveinung Gundersen, PR <a class="reference external" href="https://github.com/python/mypy/pull/16542">16542</a>）。</p></li>
<li><p>支持 Sphinx 7.x（Michael R. Crusoe, PR <a class="reference external" href="https://github.com/python/mypy/pull/16460">16460</a>）。</p></li>
</ul>
</section>
<section id="id42">
<h3>其他显著变化和修复<a class="headerlink" href="#id42" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>允许 mypy 输出包含每个文件结果的 junit 文件（Matthew Wright, PR <a class="reference external" href="https://github.com/python/mypy/pull/16388">16388</a>）。</p></li>
</ul>
</section>
<section id="id43">
<h3>Typeshed 更新<a class="headerlink" href="#id43" title="Link to this heading">¶</a></h3>
<p>请参阅 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=4a854366e03dee700109f8e758a08b2457ea2f51+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 查看标准库 typeshed stub 的完整更改列表。</p>
</section>
<section id="id44">
<h3>感谢致辞<a class="headerlink" href="#id44" title="Link to this heading">¶</a></h3>
<p>感谢所有为此版本贡献的 mypy 开发者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Chad Dombrova</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>Ilya Priven</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Marcel Telka</p></li>
<li><p>Matthew Wright</p></li>
<li><p>Michael R. Crusoe</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Ole Peder Brandtzæg</p></li>
<li><p>robjhornby</p></li>
<li><p>Shantanu</p></li>
<li><p>Sveinung Gundersen</p></li>
<li><p>Valentin Stanciu</p></li>
</ul>
<p>也感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
<p>发布者：Wesley Collin Wright</p>
</section>
</section>
<section id="mypy-1-7">
<h2>Mypy 1.7<a class="headerlink" href="#mypy-1-7" title="Link to this heading">¶</a></h2>
<p>我们刚刚将 mypy 1.7 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。此版本包含新功能、性能改进和错误修复。您可以通过以下命令安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 阅读此版本的完整文档。</p>
<section id="typeddict-kwargs">
<h3>使用 TypedDict 进行 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 类型注解<a class="headerlink" href="#typeddict-kwargs" title="Link to this heading">¶</a></h3>
<p>Mypy 现在支持将 <code class="docutils literal notranslate"><span class="pre">Unpack[...]</span></code> 与 TypedDict 类型结合使用，以注解 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 参数，默认启用。示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 或 &#39;from typing_extensions import ...&#39;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Unpack</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">Person</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">foo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 正确</span>
<span class="n">foo</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 错误</span>
</pre></div>
</div>
<p>上述 <code class="docutils literal notranslate"><span class="pre">foo</span></code> 的定义等同于以下带有仅限关键字参数 <code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">age</span></code> 的定义：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>有关更多信息，请参见 <a class="reference external" href="https://peps.python.org/pep-0692/">PEP 692</a>。请注意，与 PEP 当前版本不同，mypy 总是将带有 <code class="docutils literal notranslate"><span class="pre">Unpack[SomeTypedDict]</span></code> 的签名视为其扩展形式的等价，且对 TypedDict 参数没有特别的类型检查规则。</p>
<p>此功能由 Ivan Levkivskyi 于 2022 年贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/13471">13471</a>）。</p>
</section>
<section id="typevartuple">
<h3>TypeVarTuple 支持已启用（实验性）<a class="headerlink" href="#typevartuple" title="Link to this heading">¶</a></h3>
<p>Mypy 现在默认启用对变参泛型（TypeVarTuple）的支持，作为实验性功能。有关详细信息，请参见 <a class="reference external" href="https://peps.python.org/pep-0646/">PEP 646</a>。</p>
<p>TypeVarTuple 的实现由 Jared Hance 和 Ivan Levkivskyi 在多个 mypy 版本中完成，并得到了 Jukka Lehtosalo 的帮助。</p>
<p>本次发布包含的更改：</p>
<ul class="simple">
<li><p>修复处理带有 unpack 的元组类型上下文（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16444">16444</a>）</p></li>
<li><p>在检查重载约束时处理 TypeVarTuple（robjhornby，PR <a class="reference external" href="https://github.com/python/mypy/pull/16428">16428</a>）</p></li>
<li><p>启用 Unpack/TypeVarTuple 支持（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16354">16354</a>）</p></li>
<li><p>修复 unpack 调用特殊情况导致的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16381">16381</a>）</p></li>
<li><p>对变参类型支持进行最后的调整（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16334">16334</a>）</p></li>
<li><p>在同一可调用对象中支持 PEP-646 和 PEP-692（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16294">16294</a>）</p></li>
<li><p>支持变参类型的新 <code class="docutils literal notranslate"><span class="pre">*</span></code> 语法（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16242">16242</a>）</p></li>
<li><p>正确处理带有空参数的变参实例（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16238">16238</a>）</p></li>
<li><p>正确处理变参类型的运行时类型应用（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16240">16240</a>）</p></li>
<li><p>支持变参元组的打包/解包（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16205">16205</a>）</p></li>
<li><p>更好地支持变参调用和索引（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16131">16131</a>）</p></li>
<li><p>用户定义的变参类型的子类型和推断（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/16076">16076</a>）</p></li>
<li><p>完成对变参类型的类型分析（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15991">15991</a>）</p></li>
</ul>
</section>
<section id="id45">
<h3>安装 Mypyc 依赖的新方式<a class="headerlink" href="#id45" title="Link to this heading">¶</a></h3>
<p>如果您想安装 mypyc 所需的包依赖（不仅仅是 mypy），现在应该安装 <code class="docutils literal notranslate"><span class="pre">mypy[mypyc]</span></code> 而不是仅仅安装 <code class="docutils literal notranslate"><span class="pre">mypy</span></code>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span><span class="s1">&#39;mypy[mypyc]&#39;</span>
</pre></div>
</div>
<p>Mypy 的用户比 mypyc 多，因此始终安装 mypyc 依赖项往往会引入不必要的依赖。</p>
<p>此更改由 Shantanu 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/16229">16229</a>）。</p>
</section>
<section id="id46">
<h3>重新导出的新规则<a class="headerlink" href="#id46" title="Link to this heading">¶</a></h3>
<p>Mypy 不再将 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">a.b</span> <span class="pre">as</span> <span class="pre">b</span></code> 视为显式重新导出。旧行为可能被认为是不一致和令人惊讶的。这可能会影响一些存根包，例如旧版本的 <code class="docutils literal notranslate"><span class="pre">types-six</span></code>。如果将该导入视为重新导出是有意为之，您可以将导入更改为 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">a</span> <span class="pre">import</span> <span class="pre">b</span> <span class="pre">as</span> <span class="pre">b</span></code>。</p>
<p>此更改由 Anders Kaseorg 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/14086">14086</a>）。</p>
</section>
<section id="id47">
<h3>改进的类型推断<a class="headerlink" href="#id47" title="Link to this heading">¶</a></h3>
<p>最近引入到 mypy 的新类型推断算法（但默认未启用）现在默认启用。它特别改善了对通用可调用对象的调用的类型推断，尤其是在参数也是通用可调用对象的情况下。您可以使用 <code class="docutils literal notranslate"><span class="pre">--old-type-inference</span></code> 来禁用新行为。</p>
<p>新的算法（在少数情况下）可能会产生不同的错误消息、不同的错误代码，或在不同的行上报告错误。在不正确使用通用类型的情况下，这种情况更为常见。</p>
<p>新类型推断算法由 Ivan Levkivskyi 提供，PR <a class="reference external" href="https://github.com/python/mypy/pull/16345">16345</a> 使其默认启用。</p>
</section>
<section id="len">
<h3>使用 len() 缩小元组类型<a class="headerlink" href="#len" title="Link to this heading">¶</a></h3>
<p>Mypy 现在可以通过 <code class="docutils literal notranslate"><span class="pre">len()</span></code> 检查缩小元组类型。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">t</span>   <span class="c1"># Ok</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/16237">16237</a>）。</p>
</section>
<section id="id48">
<h3>更精确的元组长度（实验性）<a class="headerlink" href="#id48" title="Link to this heading">¶</a></h3>
<p>Mypy 通过 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature=PreciseTupleTypes</span></code> 支持对元组类型长度的实验性更精确检查。有关更多信息，请参阅 <a class="reference external" href="https://mypy.readthedocs.io/en/latest/command_line.html#enabling-incomplete-experimental-features">文档</a>。</p>
<p>一般来说，我们计划使用 <code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature</span></code> 来引入需要社区反馈的实验性功能。</p>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/16237">16237</a>）。</p>
</section>
<section id="id49">
<h3>Mypy 更新日志<a class="headerlink" href="#id49" title="Link to this heading">¶</a></h3>
<p>我们现在在 mypy Git 存储库中维护一个 <a class="reference external" href="https://github.com/python/mypy/blob/master/CHANGELOG.md">更新日志</a>。它反映了 <a class="reference external" href="https://mypy-lang.blogspot.com/">mypy 发布博客帖子</a> 的内容。我们将继续发布发布博客帖子。在未来，发布博客帖子将在发布日期附近基于更新日志创建。</p>
<p>此更改由 Shantanu 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/16280">16280</a>）。</p>
</section>
<section id="id50">
<h3>Mypy 守护进程改进<a class="headerlink" href="#id50" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复因删除子模块而导致的守护进程崩溃（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16370">16370</a>）</p></li>
<li><p>修复 dmypy 中使用 <code class="docutils literal notranslate"><span class="pre">--export-types</span></code> 时的文件重载问题（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16359">16359</a>）</p></li>
<li><p>修复 Windows 上的 dmypy inspect（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16355">16355</a>）</p></li>
<li><p>修复命名空间包的 dmypy inspect（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16357">16357</a>）</p></li>
<li><p>修复通用函数中返回类型变为可选的问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16342">16342</a>）</p></li>
<li><p>修复与模块级 <code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> 相关的守护进程误报（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16292">16292</a>）</p></li>
<li><p>修复与 ABCs 相关的守护进程崩溃（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16275">16275</a>）</p></li>
<li><p>流式输出 dmypy 而不是在最后一次性输出（Valentin Stanciu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16252">16252</a>）</p></li>
<li><p>确保显示所有 dmypy 错误（Valentin Stanciu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16250">16250</a>）</p></li>
</ul>
</section>
<section id="id51">
<h3>Mypyc 改进<a class="headerlink" href="#id51" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在重复的函数定义上生成错误（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16309">16309</a>）</p></li>
<li><p>不会因不可达语句而崩溃（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16311">16311</a>）</p></li>
<li><p>避免嵌套函数中的循环引用（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16268">16268</a>）</p></li>
<li><p>修复新 Python 中对内函数直接访问 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 的问题（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16084">16084</a>）</p></li>
<li><p>使元组的打包和解包更加高效（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16022">16022</a>）</p></li>
</ul>
</section>
<section id="id52">
<h3>错误报告改进<a class="headerlink" href="#id52" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>更新星号表达式错误消息以匹配 CPython（Cibin Mathew, PR <a class="reference external" href="https://github.com/python/mypy/pull/16304">16304</a>）</p></li>
<li><p>修复“也许您忘记使用 await”的错误代码说明（Jelle Zijlstra, PR <a class="reference external" href="https://github.com/python/mypy/pull/16203">16203</a>）</p></li>
<li><p>对于不安全的重载，使用错误代码 <code class="docutils literal notranslate"><span class="pre">[unsafe-overload]</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">[misc]</span></code>（Randolf Scholz, PR <a class="reference external" href="https://github.com/python/mypy/pull/16061">16061</a>）</p></li>
<li><p>修改与 void 函数相关的错误消息（Albert Tugushev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15876">15876</a>）</p></li>
<li><p>在消息中将底层类型表示为 Never（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15996">15996</a>）</p></li>
<li><p>为不兼容的 AsyncIterator 返回类型添加提示（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15883">15883</a>）</p></li>
<li><p>不建议使用运行时包现在附带类型的存根包（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/16226">16226</a>）</p></li>
</ul>
</section>
<section id="id53">
<h3>性能改进<a class="headerlink" href="#id53" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>加快类型参数检查（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16353">16353</a>）</p></li>
<li><p>增加自类型检查的快速路径（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16352">16352</a>）</p></li>
<li><p>缓存关于文件是否为 typeshed 文件的信息（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16351">16351</a>）</p></li>
<li><p>在日志调用中跳过不必要的昂贵 <code class="docutils literal notranslate"><span class="pre">repr()</span></code>（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/16350">16350</a>）</p></li>
</ul>
</section>
<section id="attrs">
<h3>Attrs 和数据类改进<a class="headerlink" href="#attrs" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dataclass.replace</span></code>: 允许转换类（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15915">15915</a>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dataclass.replace</span></code>: 回退到 typeshed 签名（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15962">15962</a>）</p></li>
<li><p>文档化 <code class="docutils literal notranslate"><span class="pre">dataclass_transform</span></code> 行为（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/16017">16017</a>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attrs</span></code>: 移除字段类型检查（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15983">15983</a>）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code>: 当基类不强制使用插槽时，不强制执行（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15976">15976</a>）</p></li>
<li><p>修复数据类字段/属性冲突崩溃（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16147">16147</a>）</p></li>
</ul>
</section>
<section id="id54">
<h3>Stubgen 改进<a class="headerlink" href="#id54" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>以 utf-8 编码写入存根（Jørgen Lind, PR <a class="reference external" href="https://github.com/python/mypy/pull/16329">16329</a>）</p></li>
<li><p>修复语义分析模式中缺少的属性设置器（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/16303">16303</a>）</p></li>
<li><p>统一 C 扩展和纯 Python 存根生成器，采用面向对象设计（Chad Dombrova, PR <a class="reference external" href="https://github.com/python/mypy/pull/15770">15770</a>）</p></li>
<li><p>修复生成导入的多个问题（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/15624">15624</a>）</p></li>
<li><p>生成有效的数据类存根（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/15625">15625</a>）</p></li>
</ul>
</section>
<section id="id55">
<h3>崩溃修复<a class="headerlink" href="#id55" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复方法中 TypedDict 的增量模式崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16364">16364</a>）</p></li>
<li><p>修复 TypedDict 中的星号解包崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16116">16116</a>）</p></li>
<li><p>修复增量模式下格式错误的 TypedDict 导致的崩溃（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16115">16115</a>）</p></li>
<li><p>修复命名空间包的报告生成崩溃（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16019">16019</a>）</p></li>
<li><p>修复解析错误代码配置时的拼写错误导致的崩溃（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16005">16005</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">__post_init__()</span></code> 内部错误（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/16080">16080</a>）</p></li>
</ul>
</section>
<section id="id56">
<h3>文档更新<a class="headerlink" href="#id56" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>使从 README 中复制命令更容易（Hamir Mahal, PR <a class="reference external" href="https://github.com/python/mypy/pull/16133">16133</a>）</p></li>
<li><p>文档和重命名 <code class="docutils literal notranslate"><span class="pre">[overload-overlap]</span></code> 错误代码（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16074">16074</a>）</p></li>
<li><p>文档 <code class="docutils literal notranslate"><span class="pre">--force-uppercase-builtins</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--force-union-syntax</span></code>（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16049">16049</a>）</p></li>
<li><p>文档 <code class="docutils literal notranslate"><span class="pre">force_union_syntax</span></code> 和 <code class="docutils literal notranslate"><span class="pre">force_uppercase_builtins</span></code>（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16048">16048</a>）</p></li>
<li><p>说明我们不跟踪符号之间的关系（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/16018">16018</a>）</p></li>
</ul>
</section>
<section id="id57">
<h3>其他显著变化和修复<a class="headerlink" href="#id57" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>将缩小的类型传播到 lambda 表达式（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16407">16407</a>）</p></li>
<li><p>避免从 <code class="docutils literal notranslate"><span class="pre">setuptools._distutils</span></code> 导入（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16348">16348</a>）</p></li>
<li><p>删除递归别名标志（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16346">16346</a>）</p></li>
<li><p>正确使用调用的适当子类型（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16343">16343</a>）</p></li>
<li><p>更一致地使用上界作为推断回退（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16344">16344</a>）</p></li>
<li><p>添加 <code class="docutils literal notranslate"><span class="pre">[unimported-reveal]</span></code> 错误代码（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16271">16271</a>）</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 添加 <code class="docutils literal notranslate"><span class="pre">|=</span></code> 和 <code class="docutils literal notranslate"><span class="pre">|</span></code> 运算符支持（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16249">16249</a>）</p></li>
<li><p>澄清参数的方差约定（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16302">16302</a>）</p></li>
<li><p>正确识别 <code class="docutils literal notranslate"><span class="pre">typing_extensions.NewType</span></code>（Ganden Schaffner, PR <a class="reference external" href="https://github.com/python/mypy/pull/16298">16298</a>）</p></li>
<li><p>修复缺少类型映射的部分定义（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15995">15995</a>）</p></li>
<li><p>使用 SPDX 许可证标识符（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16230">16230</a>）</p></li>
<li><p>使 <code class="docutils literal notranslate"><span class="pre">__qualname__</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__module__</span></code> 在类体中可用（Anthony Sottile, PR <a class="reference external" href="https://github.com/python/mypy/pull/16215">16215</a>）</p></li>
<li><p>stubtest: 提示存根中的参数需要为关键字参数（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/16210">16210</a>）</p></li>
<li><p>元组切片不应传播回退（Thomas Grainger, PR <a class="reference external" href="https://github.com/python/mypy/pull/16154">16154</a>）</p></li>
<li><p>修复重载情况下的类型对象处理（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16168">16168</a>）</p></li>
<li><p>修复海象运算符与空集合的交互（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16197">16197</a>）</p></li>
<li><p>在推断中使用类型变量界限（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16178">16178</a>）</p></li>
<li><p>使用上界作为推断的回退方案（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16184">16184</a>）</p></li>
<li><p>特殊处理空集合的类型推断（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16122">16122</a>）</p></li>
<li><p>允许在可调用类型中解包 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/16083">16083</a>）</p></li>
<li><p>修复具有通用 self 的重载 <code class="docutils literal notranslate"><span class="pre">__call__</span></code> 的推断（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16053">16053</a>）</p></li>
<li><p>在泛型类上调用动态类钩子（Petter Friberg, PR <a class="reference external" href="https://github.com/python/mypy/pull/16052">16052</a>）</p></li>
<li><p>通过属性访问保留隐式导出的类型（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16129">16129</a>）</p></li>
<li><p>修复 stubtest bug（Alex Waygood）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">tuple[Any,</span> <span class="pre">...]</span></code> 子类型问题（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16108">16108</a>）</p></li>
<li><p>对简单可调用后缀进行宽容处理（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15913">15913</a>）</p></li>
<li><p>为插件添加 <code class="docutils literal notranslate"><span class="pre">add_overloaded_method_to_class</span></code> 辅助函数（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16038">16038</a>）</p></li>
<li><p>将 <code class="docutils literal notranslate"><span class="pre">misc/proper_plugin.py</span></code> 打包为 <code class="docutils literal notranslate"><span class="pre">mypy</span></code> 的一部分（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/16036">16036</a>）</p></li>
<li><p>修复匹配语句中的 <code class="docutils literal notranslate"><span class="pre">case</span> <span class="pre">Any()</span></code>（DS/Charlie, PR <a class="reference external" href="https://github.com/python/mypy/pull/14479">14479</a>）</p></li>
<li><p>使可迭代逻辑更一致（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/16006">16006</a>）</p></li>
<li><p>修复具有 <code class="docutils literal notranslate"><span class="pre">__call__</span></code> 的属性的推断（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15926">15926</a>）</p></li>
</ul>
</section>
<section id="id58">
<h3>Typeshed 更新<a class="headerlink" href="#id58" title="Link to this heading">¶</a></h3>
<p>请查看 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=4a854366e03dee700109f8e758a08b2457ea2f51+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 获取标准库 typeshed 存根更改的完整列表。</p>
</section>
<section id="id59">
<h3>致谢<a class="headerlink" href="#id59" title="Link to this heading">¶</a></h3>
<p>感谢所有为此版本贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Albert Tugushev</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Anders Kaseorg</p></li>
<li><p>Anthony Sottile</p></li>
<li><p>Chad Dombrova</p></li>
<li><p>Cibin Mathew</p></li>
<li><p>dinaldoap</p></li>
<li><p>DS/Charlie</p></li>
<li><p>Eli Schwartz</p></li>
<li><p>Ganden Schaffner</p></li>
<li><p>Hamir Mahal</p></li>
<li><p>Ihor</p></li>
<li><p>Ikko Eltociear Ashimine</p></li>
<li><p>Ilya Priven</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Jørgen Lind</p></li>
<li><p>KotlinIsland</p></li>
<li><p>Matt Bogosian</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Petter Friberg</p></li>
<li><p>Randolf Scholz</p></li>
<li><p>Shantanu</p></li>
<li><p>Thomas Grainger</p></li>
<li><p>Valentin Stanciu</p></li>
</ul>
<p>同时感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
<p>发布者：Jukka Lehtosalo</p>
</section>
</section>
<section id="mypy-1-6">
<h2>Mypy 1.6<a class="headerlink" href="#mypy-1-6" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/10/mypy-16-released.html">2023年10月10日</a></p>
<p>我们刚刚将 mypy 1.6 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是 Python 的静态类型检查器。此版本包括新功能、性能改进和错误修复。您可以通过以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
<section id="id60">
<h3>引入导入错误的错误子代码<a class="headerlink" href="#id60" title="Link to this heading">¶</a></h3>
<p>当导入目标是一个不支持静态类型检查的已安装库，并且没有可用的存根文件时，mypy 现在使用错误代码 <code class="docutils literal notranslate"><span class="pre">import-untyped</span></code>。其他无效导入产生 <code class="docutils literal notranslate"><span class="pre">import-not-found</span></code> 错误代码。它们都是导入错误代码的子代码，该代码以前用于所有类型的导入相关错误。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">--disable-error-code=import-untyped</span></code> 可以仅忽略没有存根的已安装库的导入错误。这样，mypy 仍会报告例如导入语句中的拼写错误。</p>
<p>如果您使用 <code class="docutils literal notranslate"><span class="pre">--warn-unused-ignore</span></code> 或 <code class="docutils literal notranslate"><span class="pre">--strict</span></code>，mypy 会警告您使用 <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[import]</span></code> 来忽略导入错误。您应该使用更具体的错误代码。否则，忽略导入错误代码仍会静默处理这两种错误。</p>
<p>此功能由 Shantanu 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15840">15840</a>，PR <a class="reference external" href="https://github.com/python/mypy/pull/14740">14740</a>）。</p>
</section>
<section id="python-3-6">
<h3>删除对 Python 3.6 及更早版本的支持<a class="headerlink" href="#python-3-6" title="Link to this heading">¶</a></h3>
<p>不再支持使用 <code class="docutils literal notranslate"><span class="pre">--python-version</span> <span class="pre">3.6</span></code> 运行 mypy。Python 3.6 已经有一段时间没有被 mypy 正确支持，此次更新使其变得明确。此改动由 Nikita Sobolev 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15668">15668</a>）。</p>
</section>
<section id="disallow-untyped-calls">
<h3>选择性过滤 <code class="docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code> 目标<a class="headerlink" href="#disallow-untyped-calls" title="Link to this heading">¶</a></h3>
<p>使用 <code class="docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code> 可能会在使用缺失类型信息的库时产生很多错误。现在，您可以使用 <code class="docutils literal notranslate"><span class="pre">--untyped-calls-exclude=acme</span></code> 等参数来禁用关于调用 acme 包中定义的函数的错误。有关更多信息，请参阅 <a class="reference external" href="https://mypy.readthedocs.io/en/latest/command_line.html#cmdoption-mypy-untyped-calls-exclude">文档</a>。</p>
<p>此功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15845">15845</a>）。</p>
</section>
<section id="id61">
<h3>改进的可调用类型之间的类型推断<a class="headerlink" href="#id61" title="Link to this heading">¶</a></h3>
<p>Mypy 现在在可调用类型的参数中更好地推断类型变量。例如，以下代码片段现在可以正确类型检查：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">S</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span> <span class="o">...</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>  <span class="c1"># Callable[[str, int, int], None]</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15910">15910</a>）。</p>
</section>
<section id="none-typevar">
<h3>不再将 None 和 TypeVar 视为重载中的重叠<a class="headerlink" href="#none-typevar" title="Link to this heading">¶</a></h3>
<p>Mypy 现在不再将参数类型为 None 的重载项与类型变量视为重叠：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">..</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span> <span class="o">...</span>
</pre></div>
</div>
<p>之前，mypy 会对此定义产生错误。这在 T 的上界为 object 的情况下略显不安全，因为类型变量的值可能为 None。我们放宽了一些规则，以解决常见问题。</p>
<p>此功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15846">15846</a>）。</p>
</section>
<section id="new-type-inference">
<h3>对 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code> 的改进<a class="headerlink" href="#new-type-inference" title="Link to this heading">¶</a></h3>
<p>实验性的类型推断新算法（多态推断）作为 mypy 1.5 中的选择性功能推出，现在进行了多项改进：</p>
<ul class="simple">
<li><p>改进约束求解中的传递闭包计算（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15754">15754</a>）</p></li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code> 下支持上界和取值（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15813">15813</a>）</p></li>
<li><p>对变元类型的基本支持（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15879">15879</a>）</p></li>
<li><p>多态推断：支持参数规范和 lambda 表达式（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15837">15837</a>）</p></li>
<li><p>添加 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code> 时失效缓存（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/16059">16059</a>）</p></li>
</ul>
<p><strong>注意：</strong> 我们计划在 mypy 1.7 中默认启用 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code>。请尝试并告知我们您是否遇到任何问题。</p>
</section>
<section id="paramspec">
<h3>ParamSpec 的改进<a class="headerlink" href="#paramspec" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>支持包含 ParamSpec 的 self-types（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15903">15903</a>）</p></li>
<li><p>允许在 Concatenate 中使用 “…” 并清理 ParamSpec 字面量（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15905">15905</a>）</p></li>
<li><p>修复回调协议中的 ParamSpec 推断（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15986">15986</a>）</p></li>
<li><p>从参数推断 ParamSpec 约束（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15896">15896</a>）</p></li>
<li><p>修复 ParamSpec 的无效类型变量导致的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15953">15953</a>）</p></li>
<li><p>修复 ParamSpecs 之间的子类型关系（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15892">15892</a>）</p></li>
</ul>
</section>
<section id="id62">
<h3>Stubgen 的改进<a class="headerlink" href="#id62" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>添加选项以在 stubgen 中包含文档字符串（chylek，PR <a class="reference external" href="https://github.com/python/mypy/pull/13284">13284</a>）</p></li>
<li><p>为具有默认值的 NamedTuple 字段添加所需的 <code class="docutils literal notranslate"><span class="pre">...</span></code> 初始化器（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15680">15680</a>）</p></li>
</ul>
</section>
<section id="id63">
<h3>Stubtest 的改进<a class="headerlink" href="#id63" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">__mypy-replace</span></code> 误报（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/15689">15689</a>）</p></li>
<li><p>修复字节枚举子类的边缘案例（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/15943">15943</a>）</p></li>
<li><p>如果 typeshed 缺少标准库模块，则生成错误（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/15729">15729</a>）</p></li>
<li><p>修复缺失标准库模块的新检查（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/15960">15960</a>）</p></li>
<li><p>修复 stubtest 中的 enum.Flag 边缘案例（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/15933">15933</a>）</p></li>
</ul>
</section>
<section id="id64">
<h3>文档的改进<a class="headerlink" href="#id64" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>不再建议创建自己的 <code class="docutils literal notranslate"><span class="pre">assert_never</span></code> 辅助函数（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15947">15947</a>）</p></li>
<li><p>修复文档中所有缺失的引用（Albert Tugushev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15875">15875</a>）</p></li>
<li><p>记录 <code class="docutils literal notranslate"><span class="pre">await-not-async</span></code> 错误代码（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15858">15858</a>）</p></li>
<li><p>改进禁用错误代码的文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15841">15841</a>）</p></li>
</ul>
</section>
<section id="id65">
<h3>其他显著变化和修复<a class="headerlink" href="#id65" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>对不支持的 PEP 695 特性（引入于 Python 3.12）提供合理的错误消息（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/16013">16013</a>）</p></li>
<li><p>移除 <code class="docutils literal notranslate"><span class="pre">--py2</span></code> 命令行参数（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/15670">15670</a>）</p></li>
<li><p>将错误消息中的空元组从 <code class="docutils literal notranslate"><span class="pre">tuple[]</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">tuple[()]</span></code>（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15783">15783</a>）</p></li>
<li><p>修复某些节点延迟时的 <code class="docutils literal notranslate"><span class="pre">assert_type</span></code> 失败（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15920">15920</a>）</p></li>
<li><p>在未绑定的 TypeVar 有值时生成错误（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15732">15732</a>）</p></li>
<li><p>修复对 <code class="docutils literal notranslate"><span class="pre">types-google-cloud-ndb</span></code> 的过度建议（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15347">15347</a>）</p></li>
<li><p>修复对 <code class="docutils literal notranslate"><span class="pre">==</span> <span class="pre">None</span></code> 和 <code class="docutils literal notranslate"><span class="pre">in</span> <span class="pre">(None,)</span></code> 条件的类型缩小（Marti Raudsepp，PR <a class="reference external" href="https://github.com/python/mypy/pull/15760">15760</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">attrs.fields</span></code> 的推断（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15688">15688</a>）</p></li>
<li><p>将“在非异步函数中等待”设为非阻塞错误并给予错误代码（Gregory Santosa，PR <a class="reference external" href="https://github.com/python/mypy/pull/15384">15384</a>）</p></li>
<li><p>添加对装饰重载的基本支持（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15898">15898</a>）</p></li>
<li><p>修复与 self types 相关的 TypeVar 回归（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15945">15945</a>）</p></li>
<li><p>为没有字段的 dataclass 添加 <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code>（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/15749">15749</a>）</p></li>
<li><p>在 dmypy 的详细输出中包含 stdout 和 stderr（Valentin Stanciu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15881">15881</a>）</p></li>
<li><p>改进匹配缩小和可达性分析（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15882">15882</a>）</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> 与 <code class="docutils literal notranslate"><span class="pre">Literal</span></code> 在 <code class="docutils literal notranslate"><span class="pre">--warn-unreachable</span></code> 中（Jannic Warken，PR <a class="reference external" href="https://github.com/python/mypy/pull/15645">15645</a>）</p></li>
<li><p>修复从通用 &#64;frozen attrs 类继承的问题（Ilya Priven，PR <a class="reference external" href="https://github.com/python/mypy/pull/15700">15700</a>）</p></li>
<li><p>正确缩小 <code class="docutils literal notranslate"><span class="pre">tuple[type[X],</span> <span class="pre">...]</span></code> 的类型（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15691">15691</a>）</p></li>
<li><p>不将故意空的生成器标记为不可达（Ilya Priven，PR <a class="reference external" href="https://github.com/python/mypy/pull/15722">15722</a>）</p></li>
<li><p>在 mypy sdist 中添加 tox.ini（Marcel Telka，PR <a class="reference external" href="https://github.com/python/mypy/pull/15853">15853</a>）</p></li>
<li><p>修复 mypyc 在 pretty 中的回归（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/16124">16124</a>）</p></li>
</ul>
</section>
<section id="id66">
<h3>Typeshed 更新<a class="headerlink" href="#id66" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，除了标准库存根外，其他所有内容都作为独立的 PyPI 包分发。有关 typeshed 变更的完整列表，请参见 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=6a8d653a671925b0a3af61729ff8cf3f90c9c662+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a>。</p>
</section>
<section id="id67">
<h3>致谢<a class="headerlink" href="#id67" title="Link to this heading">¶</a></h3>
<p>感谢 Max Murin，他为本次发布做了大部分的发布管理工作（我只是进行了最后的步骤）。</p>
<p>感谢所有对本次发布做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Albert Tugushev</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>chylek</p></li>
<li><p>EXPLOSION</p></li>
<li><p>Gregory Santosa</p></li>
<li><p>Ilya Priven</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jannic Warken</p></li>
<li><p>KotlinIsland</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Marcel Johannesmann</p></li>
<li><p>Marcel Telka</p></li>
<li><p>Mark Byrne</p></li>
<li><p>Marti Raudsepp</p></li>
<li><p>Max Murin</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Shantanu</p></li>
<li><p>Valentin Stanciu</p></li>
</ul>
<p>由 Jukka Lehtosalo 发布。</p>
</section>
<section id="mypy-1-5">
<h3>Mypy 1.5<a class="headerlink" href="#mypy-1-5" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/08/mypy-15-released.html">2023年8月10日</a></p>
<p>我们刚刚将 mypy 1.5 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是 Python 的静态类型检查器。此版本包含新特性、弃用项和 bug 修复。您可以通过以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 阅读本次发布的完整文档。</p>
</section>
<section id="python-3-7">
<h3>删除对 Python 3.7 的支持<a class="headerlink" href="#python-3-7" title="Link to this heading">¶</a></h3>
<p>Mypy 不再支持运行在 Python 3.7 上，因为该版本已达到生命周期结束。这项更改由 Shantanu 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15566">15566</a>）。</p>
</section>
<section id="override">
<h3>可选检查以强制要求显式 &#64;override<a class="headerlink" href="#override" title="Link to this heading">¶</a></h3>
<p>如果启用 <code class="docutils literal notranslate"><span class="pre">explicit-override</span></code> 错误代码，mypy 将生成错误，如果方法重写没有使用 <code class="docutils literal notranslate"><span class="pre">&#64;typing.override</span></code> 装饰器（如 [PEP 698](https://peps.python.org/pep-0698/#strict-enforcement-per-project）中讨论的那样）。这样，mypy 可以检测到意外引入的重写。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: enable-error-code=&quot;explicit-override&quot;</span>

<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">override</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="c1"># 错误：方法 &quot;foo&quot; 未使用 @override，但正在重写</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="nd">@override</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># 正确</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>您可以通过 <code class="docutils literal notranslate"><span class="pre">--enable-error-code=explicit-override</span></code> 在 mypy 命令行中启用此错误代码，或在 mypy 配置文件中设置 <code class="docutils literal notranslate"><span class="pre">enable_error_code</span> <span class="pre">=</span> <span class="pre">explicit-override</span></code>。</p>
<p>该装饰器将在 Python 3.12 的 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 中可用，但您也可以在所有支持的 Python 版本中使用最近版本的 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 的回溯版本。</p>
<p>此功能由 Marc Mueller 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15512">15512</a>）。</p>
</section>
<section id="id68">
<h3>更灵活的 TypedDict 创建和更新<a class="headerlink" href="#id68" title="Link to this heading">¶</a></h3>
<p>之前，Mypy 在类型检查 TypedDict 的创建和更新操作时过于严格。尽管这些检查在技术上通常是正确的，但有时会对看似有效的代码触发错误。现在，默认情况下，这些检查已经放宽。您可以通过使用新的 <code class="docutils literal notranslate"><span class="pre">--extra-checks</span></code> 标志启用更严格的检查。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">**</span></code> 语法进行构造现在更加灵活：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">foo</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">a</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">a2</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="p">{</span> <span class="o">**</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">b</span><span class="p">}</span>  <span class="c1"># OK（之前会报错）</span>
</pre></div>
</div>
<p>您也可以使用包含更新的 TypedDict 子集的 TypedDict 参数调用 <code class="docutils literal notranslate"><span class="pre">update()</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># OK（之前会报错）</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15425">15425</a>）。</p>
</section>
<section id="strict-concatenate">
<h3>弃用标志：<code class="docutils literal notranslate"><span class="pre">--strict-concatenate</span></code><a class="headerlink" href="#strict-concatenate" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--strict-concatenate</span></code> 的行为现在已包含在新的 <code class="docutils literal notranslate"><span class="pre">--extra-checks</span></code> 标志中，旧标志被弃用。</p>
</section>
<section id="id69">
<h3>可选显示错误代码文档链接<a class="headerlink" href="#id69" title="Link to this heading">¶</a></h3>
<p>如果您使用 <code class="docutils literal notranslate"><span class="pre">--show-error-code-links</span></code>，mypy 将为（许多）报告的错误添加文档链接。对于足够明显的错误消息，将不会显示链接，每个错误代码只显示一次。</p>
<p>示例输出：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Need</span> <span class="nb">type</span> <span class="n">annotation</span> <span class="k">for</span> <span class="s2">&quot;foo&quot;</span> <span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="s2">&quot;x: List[&lt;type&gt;] = ...&quot;</span><span class="p">)</span>  <span class="p">[</span><span class="n">var</span><span class="o">-</span><span class="n">annotated</span><span class="p">]</span>
<span class="n">a</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="n">See</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mypy</span><span class="o">.</span><span class="n">rtfd</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">en</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">_refs</span><span class="o">.</span><span class="n">html</span><span class="c1">#code-var-annotated for more info</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15449">15449</a>）。</p>
</section>
<section id="id70">
<h3>一致地避免对不可达代码进行类型检查<a class="headerlink" href="#id70" title="Link to this heading">¶</a></h3>
<p>如果模块顶层有不可达代码，mypy 将不会对不可达语句进行类型检查。这与函数的行为一致。<code class="docutils literal notranslate"><span class="pre">--warn-unreachable</span></code> 的行为现在也更为一致。</p>
<p>此功能由 Ilya Priven 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15386">15386</a>）。</p>
</section>
<section id="id71">
<h3>实验性改进的泛型函数类型推断<a class="headerlink" href="#id71" title="Link to this heading">¶</a></h3>
<p>您可以使用 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code> 选择加入一个实验性的新类型推断算法。它特别修复了在调用参数也是泛型函数的泛型函数时出现的问题。当前的实现仍然不完整，但我们鼓励您尝试并报告任何回归问题。我们计划在未来的 mypy 版本中默认启用这个新算法。</p>
<p>此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/15287">15287</a>）。</p>
</section>
<section id="python-3-12">
<h3>对 Python 3.12 的部分支持<a class="headerlink" href="#python-3-12" title="Link to this heading">¶</a></h3>
<p>Mypy 和 mypyc 现在支持在最近的 Python 3.12 开发版本上运行。并非所有新特性都被支持，目前还没有为 Python 3.12 提供编译的 wheel 文件。</p>
<ul class="simple">
<li><p>修复 Python 3.12 的 AST 警告（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15558">15558</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上协议的多重继承（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15572">15572</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上的自编译（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15582">15582</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上带有 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 的实例的序列化问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15574">15574</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上的 i16 问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15510">15510</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上的整数运算（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15470">15470</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上的生成器问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15472">15472</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上带有 <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> 的类的问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15471">15471</a>）</p></li>
<li><p>mypyc：修复 Python 3.12 上的协程问题（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15469">15469</a>）</p></li>
<li><p>mypyc：在 Python 3.12 上不再使用 <code class="docutils literal notranslate"><span class="pre">PyErr_ChainExceptions</span></code>，因为它已被弃用（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15468">15468</a>）</p></li>
<li><p>mypyc：添加 Python 3.12 特性宏（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15465">15465</a>）</p></li>
</ul>
</section>
<section id="id72">
<h3>数据类改进<a class="headerlink" href="#id72" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>改进 <code class="docutils literal notranslate"><span class="pre">dataclasses.replace</span></code> 的签名（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/14849">14849</a>）</p></li>
<li><p>修复数据类与协议结合时的崩溃问题（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15629">15629</a>）</p></li>
<li><p>修复数据类中的严格可选项处理（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15571">15571</a>）</p></li>
<li><p>支持自定义数据类描述符的可选类型（Marc Mueller, PR <a class="reference external" href="https://github.com/python/mypy/pull/15628">15628</a>）</p></li>
<li><p>为数据类添加 <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> 属性（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15649">15649</a>）</p></li>
<li><p>支持更好的 <code class="docutils literal notranslate"><span class="pre">__post_init__</span></code> 方法签名（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15503">15503</a>）</p></li>
</ul>
</section>
<section id="id73">
<h3>Mypyc 改进<a class="headerlink" href="#id73" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>支持无符号 8 位原生整数类型：<code class="docutils literal notranslate"><span class="pre">mypy_extensions.u8</span></code>（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15564">15564</a>）</p></li>
<li><p>支持有符号 16 位原生整数类型：<code class="docutils literal notranslate"><span class="pre">mypy_extensions.i16</span></code>（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15464">15464</a>）</p></li>
<li><p>在存根中定义 <code class="docutils literal notranslate"><span class="pre">mypy_extensions.i16</span></code>（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15562">15562</a>）</p></li>
<li><p>记录更多不支持的特性并更新支持的特性（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/15524">15524</a>）</p></li>
<li><p>修复最终命名元组类（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/15513">15513</a>）</p></li>
<li><p>使用 C99 复合字面量处理未定义的元组值（Jukka Lehtosalo, PR <a class="reference external" href="https://github.com/python/mypy/pull/15453">15453</a>）</p></li>
<li><p>在设置函数中不显式分配 NULL 值（Logan Hunt, PR <a class="reference external" href="https://github.com/python/mypy/pull/15379">15379</a>）</p></li>
</ul>
</section>
<section id="id74">
<h3>Stubgen 改进<a class="headerlink" href="#id74" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>教授 stubgen 处理复杂和一元表达式（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15661">15661</a>）</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> 和 <code class="docutils literal notranslate"><span class="pre">TypeVarTuple</span></code>（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/15626">15626</a>）</p></li>
<li><p>修复非字符串文档字符串导致的崩溃（Ali Hamdan, PR <a class="reference external" href="https://github.com/python/mypy/pull/15623">15623</a>）</p></li>
</ul>
</section>
<section id="id75">
<h3>文档更新<a class="headerlink" href="#id75" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>添加额外错误代码的文档（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15539">15539</a>）</p></li>
<li><p>改进类型缩减的文档（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15652">15652</a>）</p></li>
<li><p>对协议文档进行小幅改进（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15460">15460</a>）</p></li>
<li><p>在速查表中移除令人困惑的实例变量示例（Adel Atallah, PR <a class="reference external" href="https://github.com/python/mypy/pull/15441">15441</a>）</p></li>
</ul>
</section>
<section id="id76">
<h3>其他显著修复和改进<a class="headerlink" href="#id76" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>常量折叠额外的单元和二元表达式（Richard Si, PR <a class="reference external" href="https://github.com/python/mypy/pull/15202">15202</a>）</p></li>
<li><p>从 Protocol 中排除与 CPython 相同的特殊属性（Kyle Benesch, PR <a class="reference external" href="https://github.com/python/mypy/pull/15490">15490</a>）</p></li>
<li><p>将 attrs.define 的 slots 参数的默认值更改为 True，以匹配运行时行为（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15642">15642</a>）</p></li>
<li><p>修复如果属性在类和元类中都定义时的类属性类型（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/14988">14988</a>）</p></li>
<li><p>在类方法的第一个参数中将 type 处理为 typing.Type（Erik Kemperman, PR <a class="reference external" href="https://github.com/python/mypy/pull/15297">15297</a>）</p></li>
<li><p>修复 --find-occurrences 标志（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15528">15528</a>）</p></li>
<li><p>修复类模式的错误位置（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15506">15506</a>）</p></li>
<li><p>修复在 mypy 守护进程中重新添加带有错误的文件（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15440">15440</a>）</p></li>
<li><p>修复 Windows 上的 dmypy 运行（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15429">15429</a>）</p></li>
<li><p>修复属性删除器的抽象和非抽象变体错误（Shantanu, PR <a class="reference external" href="https://github.com/python/mypy/pull/15395">15395</a>）</p></li>
<li><p>从错误消息中移除“cannot”的特殊处理（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15428">15428</a>）</p></li>
<li><p>为 attrs 类添加运行时 <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> 属性（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15651">15651</a>）</p></li>
<li><p>将 get_expression_type 添加到 CheckerPluginInterface（Ilya Priven, PR <a class="reference external" href="https://github.com/python/mypy/pull/15369">15369</a>）</p></li>
<li><p>从 NamedTuple._make() 中移除不再存在的参数（Alex Waygood, PR <a class="reference external" href="https://github.com/python/mypy/pull/15578">15578</a>）</p></li>
<li><p>允许在使用显式 &#64;staticmethod 装饰器时在 <code class="docutils literal notranslate"><span class="pre">__all__</span></code> 中使用 typing.Self（Erik Kemperman, PR <a class="reference external" href="https://github.com/python/mypy/pull/15353">15353</a>）</p></li>
<li><p>修复没有 Self 注解的子类方法中的自引用类型（Ivan Levkivskyi, PR <a class="reference external" href="https://github.com/python/mypy/pull/15541">15541</a>）</p></li>
<li><p>在元组中检查抽象类对象（Nikita Sobolev, PR <a class="reference external" href="https://github.com/python/mypy/pull/15366">15366</a>）</p></li>
</ul>
</section>
<section id="id77">
<h3>Typeshed 更新<a class="headerlink" href="#id77" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，并作为单独的 PyPI 包分发，除了标准库存根之外。请参见 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=fc7d4722eaa54803926cee5730e1f784979c0531+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 了解 Typeshed 变化的完整列表。</p>
</section>
<section id="id78">
<h3>致谢<a class="headerlink" href="#id78" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Adel Atallah</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Erik Kemperman</p></li>
<li><p>Federico Padua</p></li>
<li><p>Ilya Priven</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jared Hance</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Kyle Benesch</p></li>
<li><p>Logan Hunt</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Richard Si</p></li>
<li><p>Shantanu</p></li>
<li><p>Stavros Ntentos</p></li>
<li><p>Valentin Stanciu</p></li>
</ul>
<p>由 Valentin Stanciu 发布</p>
</section>
</section>
<section id="mypy-1-4">
<h2>Mypy 1.4<a class="headerlink" href="#mypy-1-4" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/06/mypy-140-released.html">2023年6月20日</a></p>
<p>我们刚刚将 mypy 1.4 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。此版本包含新特性、性能改进和 bug 修复。您可以通过以下方式安装它：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
<section id="id79">
<h3>重写装饰器<a class="headerlink" href="#id79" title="Link to this heading">¶</a></h3>
<p>Mypy 现在可以确保在重命名方法时，重写的方法也被重命名。您可以通过使用 <code class="docutils literal notranslate"><span class="pre">&#64;typing.override</span></code> 装饰器（<a class="reference external" href="https://peps.python.org/pep-0698/">PEP 698</a>）显式标记一个方法为重写基类方法。如果方法在基类中被重命名，而重写的方法没有，mypy 将生成错误。此装饰器将在 Python 3.12 的 typing 中提供，但您也可以在所有受支持的 Python 版本中使用最近版本的 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 中的回溯版本。</p>
<p>该功能由 Thomas M Kehrenberg 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/14609">14609</a>）。</p>
</section>
<section id="id80">
<h3>向嵌套函数传播类型收窄<a class="headerlink" href="#id80" title="Link to this heading">¶</a></h3>
<p>之前，类型收窄不会传播到嵌套函数，因为如果收窄的变量在嵌套函数的定义和调用之间发生变化，则这将不合理。Mypy 现在将在变量在嵌套函数定义后未被赋值的情况下传播收窄的类型：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">calculate_default</span><span class="p">()</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># &quot;str&quot; (收窄)</span>

    <span class="k">def</span> <span class="nf">nested</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># 现在是 &quot;str&quot;（之前是 &quot;str | None&quot;）</span>

    <span class="n">nested</span><span class="p">()</span>
</pre></div>
</div>
<p>这可能会生成一些新错误，因为之前必要的断言可能变得是平凡的或无操作的。</p>
<p>该功能由 Jukka Lehtosalo 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/15133">15133</a>）。</p>
</section>
<section id="id81">
<h3>使用“==”收窄枚举值<a class="headerlink" href="#id81" title="Link to this heading">¶</a></h3>
<p>Mypy 现在允许使用 <code class="docutils literal notranslate"><span class="pre">==</span></code> 操作符来收窄枚举类型。之前，仅支持使用 <code class="docutils literal notranslate"><span class="pre">is</span></code> 操作符。这使得对枚举类型的穷尽性检查更加可用，因为仅使用 <code class="docutils literal notranslate"><span class="pre">is</span></code> 操作符的要求并不直观。在以下示例中，mypy 可以检测到开发者忘记处理值 <code class="docutils literal notranslate"><span class="pre">MyEnum.C</span></code> 的情况：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">MyEnum</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># 错误：缺少返回语句</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">A</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;y&#39;</span>
</pre></div>
</div>
<p>添加一个额外的 <code class="docutils literal notranslate"><span class="pre">elif</span></code> 分支可以解决该错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">MyEnum</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># 无错误 -- 所有值均已覆盖</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">A</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;x&#39;</span>
    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;y&#39;</span>
    <span class="k">elif</span> <span class="n">e</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">C</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;z&#39;</span>
</pre></div>
</div>
<p>这一变化可能会导致在使用 <code class="docutils literal notranslate"><span class="pre">--strict-equality</span></code> 时出现测试用例中的误报，比如在断言语句 <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">o.x</span> <span class="pre">==</span> <span class="pre">SomeEnum.X</span></code> 中。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: strict-equality</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">MyEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">MyEnum</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">test_something</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">A</span>
    <span class="n">c</span><span class="o">.</span><span class="n">do_something_that_changes_x</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">B</span>  <span class="c1"># 错误：非重叠的相等检查</span>
</pre></div>
</div>
<p>可以使用 <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[comparison-overlap]</span></code> 来忽略这些错误，或者使用临时变量作为解决方法进行断言：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_something</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">A</span>  <span class="c1"># 不收窄 c.x</span>
    <span class="n">c</span><span class="o">.</span><span class="n">do_something_that_changes_x</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">==</span> <span class="n">MyEnum</span><span class="o">.</span><span class="n">B</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>该功能由 Shantanu 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/11521">11521</a>）。</p>
</section>
<section id="id82">
<h3>性能改进<a class="headerlink" href="#id82" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>加快大联合类型的简化，同时修复递归元组崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15128">15128</a>）。</p></li>
<li><p>加快联合子类型的检查（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15104">15104</a>）。</p></li>
<li><p>在类型检查第三方库代码时，或在忽略错误时不检查大多数函数体（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14150">14150</a>）。</p></li>
</ul>
</section>
<section id="id83">
<h3>插件改进<a class="headerlink" href="#id83" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">attrs.evolve</span></code>: 支持泛型和联合类型（Ilya Konstantinov，PR <a class="reference external" href="https://github.com/python/mypy/pull/15050">15050</a>）。</p></li>
<li><p>修复 ctypes 插件（Alex Waygood）。</p></li>
</ul>
</section>
<section id="id84">
<h3>崩溃修复<a class="headerlink" href="#id84" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复当函数范围递归别名作为上界时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15159">15159</a>）。</p></li>
<li><p>修复在 <code class="docutils literal notranslate"><span class="pre">follow_imports_for_stubs</span></code> 中的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15407">15407</a>）。</p></li>
<li><p>修复在显式初始化子类中的 <code class="docutils literal notranslate"><span class="pre">stubtest</span></code> 崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15399">15399</a>）。</p></li>
<li><p>修复在使用空键索引 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 时的崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15392">15392</a>）。</p></li>
<li><p>修复作为属性的 <code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> 崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15404">15404</a>）。</p></li>
<li><p>正确跟踪嵌套函数/类的循环深度（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15403">15403</a>）。</p></li>
<li><p>修复递归元组连接时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15402">15402</a>）。</p></li>
<li><p>修复自定义 <code class="docutils literal notranslate"><span class="pre">ErrorCode</span></code> 子类的崩溃（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/15327">15327</a>）。</p></li>
<li><p>修复在数据类协议中赋值给 <code class="docutils literal notranslate"><span class="pre">self</span></code> 属性时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15157">15157</a>）。</p></li>
<li><p>修复在泛型上下文中使用泛型方法体内的 lambda 时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15155">15155</a>）。</p></li>
<li><p>修复在 <code class="docutils literal notranslate"><span class="pre">make_simplified_union</span></code> 中的递归类型别名崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15216">15216</a>）。</p></li>
</ul>
</section>
<section id="id85">
<h3>错误消息改进<a class="headerlink" href="#id85" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在错误消息中使用小写的内置集合类型，如 <code class="docutils literal notranslate"><span class="pre">list[...]</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">List[...]</span></code>，当目标是 Python 3.9+ 时（Max Murin，PR <a class="reference external" href="https://github.com/python/mypy/pull/15070">15070</a>）。</p></li>
<li><p>当目标是 Python 3.10+ 时，在错误消息中使用 <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">|</span> <span class="pre">Y</span></code> 联合语法（Omar Silva，PR <a class="reference external" href="https://github.com/python/mypy/pull/15102">15102</a>）。</p></li>
<li><p>当目标是 Python 3.9+ 时，在错误消息中使用 <code class="docutils literal notranslate"><span class="pre">type</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">Type</span></code>（Rohit Sanjay，PR <a class="reference external" href="https://github.com/python/mypy/pull/15139">15139</a>）。</p></li>
<li><p>在不可达代码中不显示未使用的忽略错误，并使其成为真实错误代码（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15164">15164</a>）。</p></li>
<li><p>默认不限制显示的错误数量（Rohit Sanjay，PR <a class="reference external" href="https://github.com/python/mypy/pull/15138">15138</a>）。</p></li>
<li><p>改进对真实函数的消息（madt2709，PR <a class="reference external" href="https://github.com/python/mypy/pull/15193">15193</a>）。</p></li>
<li><p>当类型名称模糊时，输出不同的类型（teresa0605，PR <a class="reference external" href="https://github.com/python/mypy/pull/15184">15184</a>）。</p></li>
<li><p>更新关于 <code class="docutils literal notranslate"><span class="pre">try</span></code> 中无效异常类型的消息（AJ Rasmussen，PR <a class="reference external" href="https://github.com/python/mypy/pull/15131">15131</a>）。</p></li>
<li><p>如果参数类型因不支持的数字类型而不兼容，添加解释（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/15137">15137</a>）。</p></li>
<li><p>为非可调用类型的“与超类型不兼容的签名”消息添加更多细节（Ilya Priven，PR <a class="reference external" href="https://github.com/python/mypy/pull/15263">15263</a>）。</p></li>
</ul>
</section>
<section id="id86">
<h3>文档更新<a class="headerlink" href="#id86" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>在 <code class="docutils literal notranslate"><span class="pre">dmypy</span></code> 文档中添加 <code class="docutils literal notranslate"><span class="pre">--local-partial-types</span></code> 注释（Alan Du，PR <a class="reference external" href="https://github.com/python/mypy/pull/15259">15259</a>）。</p></li>
<li><p>更新 Windows 的 <code class="docutils literal notranslate"><span class="pre">mypy</span></code> 开始文档（Valentin Stanciu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15233">15233</a>）。</p></li>
<li><p>澄清文档中关于可调用对象的类型对象使用（Viicos，PR <a class="reference external" href="https://github.com/python/mypy/pull/15079">15079</a>）。</p></li>
<li><p>澄清 <code class="docutils literal notranslate"><span class="pre">disallow_untyped_defs</span></code> 和 <code class="docutils literal notranslate"><span class="pre">disallow_incomplete_defs</span></code> 之间的区别（Ilya Priven，PR <a class="reference external" href="https://github.com/python/mypy/pull/15247">15247</a>）。</p></li>
<li><p>在文档和测试中使用 <code class="docutils literal notranslate"><span class="pre">attrs</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&#64;attrs.define</span></code>（Ilya Priven，PR <a class="reference external" href="https://github.com/python/mypy/pull/15152">15152</a>）。</p></li>
</ul>
</section>
<section id="id87">
<h3>Mypyc 改进<a class="headerlink" href="#id87" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复某些变量在推断可选类型时出现的意外 <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/15206">15206</a>）。</p></li>
<li><p>内联数学字面量（Logan Hunt，PR <a class="reference external" href="https://github.com/python/mypy/pull/15324">15324</a>）。</p></li>
<li><p>支持在字典显示中解包映射（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/15203">15203</a>）。</p></li>
</ul>
</section>
<section id="id88">
<h3>Stubgen 变更<a class="headerlink" href="#id88" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>不从基类中移除 <code class="docutils literal notranslate"><span class="pre">Generic</span></code>（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/15316">15316</a>）。</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> 语句（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/15271">15271</a>）。</p></li>
<li><p>修复缺失的 <code class="docutils literal notranslate"><span class="pre">total</span></code> 在 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类中（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/15208">15208</a>）。</p></li>
<li><p>修复基于调用的 <code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> 被省略在类基中（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/14680">14680</a>）。</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 替代语法（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/14682">14682</a>）。</p></li>
<li><p>使 <code class="docutils literal notranslate"><span class="pre">stubgen</span></code> 尊重 <code class="docutils literal notranslate"><span class="pre">MYPY_CACHE_DIR</span></code>（Henrik Bäärnhielm，PR <a class="reference external" href="https://github.com/python/mypy/pull/14722">14722</a>）。</p></li>
<li><p>修复和简化（Ali Hamdan，PR <a class="reference external" href="https://github.com/python/mypy/pull/15232">15232</a>）。</p></li>
</ul>
</section>
<section id="id89">
<h3>其他显著修复和改进<a class="headerlink" href="#id89" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复使用 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> 值限制时嵌套异步函数的问题（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14705">14705</a>）。</p></li>
<li><p>始终允许从 lambda 返回 <code class="docutils literal notranslate"><span class="pre">Any</span></code>（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15413">15413</a>）。</p></li>
<li><p>为 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> 默认值添加基础（PEP 696）（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14872">14872</a>）。</p></li>
<li><p>更新语义分析器以支持 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> 默认值（PEP 696）（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14873">14873</a>）。</p></li>
<li><p>使字典表达式推断更一致（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/15174">15174</a>）。</p></li>
<li><p>不阻止重复基类（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/15367">15367</a>）。</p></li>
<li><p>当同时使用 <code class="docutils literal notranslate"><span class="pre">staticmethod</span></code> 和 <code class="docutils literal notranslate"><span class="pre">classmethod</span></code> 装饰器时生成错误（Juhi Chandalia，PR <a class="reference external" href="https://github.com/python/mypy/pull/15118">15118</a>）。</p></li>
<li><p>修复字面量的 <code class="docutils literal notranslate"><span class="pre">assert_type</span></code> 行为（Carl Karsten，PR <a class="reference external" href="https://github.com/python/mypy/pull/15123">15123</a>）。</p></li>
<li><p>修复匹配主题忽略重新定义的问题（Vincent Vanlaer，PR <a class="reference external" href="https://github.com/python/mypy/pull/15306">15306</a>）。</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">__all__.remove</span></code>（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15279">15279</a>）。</p></li>
</ul>
</section>
<section id="id90">
<h3>Typeshed 更新<a class="headerlink" href="#id90" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，并作为独立的 PyPI 包进行分发，除了标准库存根。有关 typeshed 变更的完整列表，请参见 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=877e06ad1cfd9fd9967c0b0340a86d0c23ea89ce+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a>。</p>
</section>
<section id="id91">
<h3>致谢<a class="headerlink" href="#id91" title="Link to this heading">¶</a></h3>
<p>感谢所有为此次发布贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Adrian Garcia Badaracco</p></li>
<li><p>AJ Rasmussen</p></li>
<li><p>Alan Du</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Ali Hamdan</p></li>
<li><p>Carl Karsten</p></li>
<li><p>dosisod</p></li>
<li><p>Ethan Smith</p></li>
<li><p>Gregory Santosa</p></li>
<li><p>Heather White</p></li>
<li><p>Henrik Bäärnhielm</p></li>
<li><p>Ilya Konstantinov</p></li>
<li><p>Ilya Priven</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Juhi Chandalia</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Logan Hunt</p></li>
<li><p>madt2709</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Max Murin</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Omar Silva</p></li>
<li><p>Özgür</p></li>
<li><p>Richard Si</p></li>
<li><p>Rohit Sanjay</p></li>
<li><p>Shantanu</p></li>
<li><p>teresa0605</p></li>
<li><p>Thomas M Kehrenberg</p></li>
<li><p>Tin Tvrtković</p></li>
<li><p>Tushar Sadhwani</p></li>
<li><p>Valentin Stanciu</p></li>
<li><p>Viicos</p></li>
<li><p>Vincent Vanlaer</p></li>
<li><p>Wesley Collin Wright</p></li>
<li><p>William Santosa</p></li>
<li><p>yaegassy</p></li>
</ul>
<p>还要感谢我的雇主 Dropbox 对 mypy 开发的支持。</p>
<p>发布者：Jared Hance</p>
</section>
<section id="mypy-1-3">
<h3>Mypy 1.3<a class="headerlink" href="#mypy-1-3" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/05/mypy-13-released.html">2023年5月10日</a></p>
<p>我们刚刚将 mypy 1.3 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。本次发布包括新特性、性能改进和错误修复。您可以通过以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
</section>
<section id="id92">
<h3>性能改进<a class="headerlink" href="#id92" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>改进联合子类型的性能（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15104">15104</a>）。</p></li>
<li><p>添加负子类型缓存（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14884">14884</a>）。</p></li>
</ul>
</section>
<section id="stub">
<h3>Stub 工具改进<a class="headerlink" href="#stub" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Stubtest：检查如果运行时是抽象的，则存根也是抽象的，即使存根是重载的方法（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14955">14955</a>）。</p></li>
<li><p>Stubtest：验证存根方法或属性在运行时是否被 &#64;final 装饰（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14951">14951</a>）。</p></li>
<li><p>Stubtest：修复运行时与 TypedDict 相关的假阳性（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14984">14984</a>）。</p></li>
<li><p>Stubgen：支持 &#64;functools.cached_property（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14981">14981</a>）。</p></li>
<li><p>对 stubgenc 的改进（Chad Dombrova，PR <a class="reference external" href="https://github.com/python/mypy/pull/14564">14564</a>）。</p></li>
</ul>
</section>
<section id="id93">
<h3>attrs 改进<a class="headerlink" href="#id93" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>为泛型 attrs 类添加对 TypeVars 转换器的支持（Chad Dombrova，PR <a class="reference external" href="https://github.com/python/mypy/pull/14908">14908</a>）。</p></li>
<li><p>修复在绑定的 TypeVar 上的 attrs.evolve（Ilya Konstantinov，PR <a class="reference external" href="https://github.com/python/mypy/pull/15022">15022</a>）。</p></li>
</ul>
</section>
<section id="id94">
<h3>文档更新<a class="headerlink" href="#id94" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>改进异步文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14973">14973</a>）。</p></li>
<li><p>对备忘单进行改进（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14972">14972</a>）。</p></li>
<li><p>添加字节格式错误代码的文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14971">14971</a>）。</p></li>
<li><p>将不安全链接转换为 HTTPS（Marti Raudsepp，PR <a class="reference external" href="https://github.com/python/mypy/pull/14974">14974</a>）。</p></li>
<li><p>在异步迭代器文档中也提到重载（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14998">14998</a>）。</p></li>
<li><p>stubtest：改善允许列表文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15008">15008</a>）。</p></li>
<li><p>澄清“使用类型...但不在运行时”（Jon Shea，PR <a class="reference external" href="https://github.com/python/mypy/pull/15029">15029</a>）。</p></li>
<li><p>修复备忘单示例的对齐（Ondřej Cvacho，PR <a class="reference external" href="https://github.com/python/mypy/pull/15039">15039</a>）。</p></li>
<li><p>修复回调协议与可调用类型对象匹配的错误（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15042">15042</a>）。</p></li>
</ul>
</section>
<section id="id95">
<h3>错误报告改进<a class="headerlink" href="#id95" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>改进字节格式错误（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14959">14959</a>）。</p></li>
</ul>
</section>
<section id="id96">
<h3>Mypyc 改进<a class="headerlink" href="#id96" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复布尔值和整数的联合（Tomer Chachamu，PR <a class="reference external" href="https://github.com/python/mypy/pull/15066">15066</a>）。</p></li>
</ul>
</section>
<section id="id97">
<h3>其他修复和改进<a class="headerlink" href="#id97" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复使用 isinstance 时的 Self 包含的联合类型缩小（Christoph Tyralla，PR <a class="reference external" href="https://github.com/python/mypy/pull/14923">14923</a>）。</p></li>
<li><p>允许匹配 SupportsKeysAndGetItem 的对象被解包（Bryan Forbes，PR <a class="reference external" href="https://github.com/python/mypy/pull/14990">14990</a>）。</p></li>
<li><p>检查静态方法的类型保护有效性（EXPLOSION，PR <a class="reference external" href="https://github.com/python/mypy/pull/14953">14953</a>）。</p></li>
<li><p>修复使用 emscripten 交叉编译时的 sys.platform（Ethan Smith，PR <a class="reference external" href="https://github.com/python/mypy/pull/14888">14888</a>）。</p></li>
</ul>
</section>
<section id="id98">
<h3>Typeshed 更新<a class="headerlink" href="#id98" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，并作为独立的 PyPI 包进行分发，除了标准库存根。有关 typeshed 变更的完整列表，请参见 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=b0ed50e9392a23e52445b630a808153e0e256976+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a>。</p>
</section>
<section id="id99">
<h3>感谢名单<a class="headerlink" href="#id99" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Amin Alaee</p></li>
<li><p>Bryan Forbes</p></li>
<li><p>Chad Dombrova</p></li>
<li><p>Charlie Denton</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>dosisod</p></li>
<li><p>Ethan Smith</p></li>
<li><p>EXPLOSION</p></li>
<li><p>Ilya Konstantinov</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jon Shea</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>KotlinIsland</p></li>
<li><p>Marti Raudsepp</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Ondřej Cvacho</p></li>
<li><p>Shantanu</p></li>
<li><p>sobolevn</p></li>
<li><p>Tomer Chachamu</p></li>
<li><p>Yaroslav Halchenko</p></li>
</ul>
<p>发布者：Wesley Collin Wright。</p>
</section>
</section>
<hr class="docutils" />
<section id="mypy-1-2">
<h2>Mypy 1.2<a class="headerlink" href="#mypy-1-2" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/04/mypy-12-released.html">2023年4月6日</a></p>
<p>我们刚刚将 mypy 1.2 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 的静态类型检查器。本次发布包括新特性、性能改进和错误修复。您可以通过以下方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读此版本的完整文档。</p>
<section id="id100">
<h3>数据类转换的改进<a class="headerlink" href="#id100" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>支持字段说明符中“init”参数的隐式默认值（Wesley Collin Wright 和 Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/15010">15010</a>）。</p></li>
<li><p>支持数据类转换中的描述符（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/15006">15006</a>）。</p></li>
<li><p>修复增量模式中的 frozen_default（Wesley Collin Wright）。</p></li>
<li><p>修复具有直接元类的基类的冻结行为（Wesley Collin Wright，PR <a class="reference external" href="https://github.com/python/mypy/pull/14878">14878</a>）。</p></li>
</ul>
</section>
<section id="id101">
<h3>Mypyc：原生浮点数<a class="headerlink" href="#id101" title="Link to this heading">¶</a></h3>
<p>Mypyc 现在为 float 类型的值使用原生、未包装的表示。以前，这些值是堆分配的 Python 对象。原生浮点数速度更快且占用更少的内存。使用浮点运算的代码在使用原生浮点数时可以快几倍。</p>
<p>各种浮点操作和数学函数现在也有优化的实现。有关完整列表，请参阅 <a class="reference external" href="https://mypyc.readthedocs.io/en/latest/float_operations.html">文档</a>。</p>
<p>这可能会改变现有使用 float 子类的代码的行为。当将 float 子类的实例赋值给 float 类型的变量时，它会在编译时隐式转换为 float 实例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">MyFloat</span>  <span class="c1"># MyFloat 是 float 的子类</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">MyFloat</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># 从 MyFloat 到 float 的隐式转换</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>  <span class="c1"># float，而不是 MyFloat</span>
</pre></div>
</div>
<p>以前，隐式转换适用于 int 子类，但不适用于 float 子类。</p>
<p>此外，int 值不能再赋值给 float 类型的变量，因为这些类型现在具有不兼容的表示。需要显式转换：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 错误：不能将 &quot;int&quot; 赋值给 &quot;float&quot;</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># 正确</span>
    <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">n</span>  <span class="c1"># 错误</span>
    <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># 正确</span>
</pre></div>
</div>
<p>此限制仅适用于赋值，因为否则它们可能会将变量的类型从 float 缩小到 int。int 值在作为期望 float 值的函数的参数传递时仍可以隐式转换为 float。</p>
<p>请注意，mypy 仍然不支持未包装浮点值的数组。使用 list[float] 涉及堆分配的浮点对象，因为列表只能存储包装值。对高效浮点数组的支持是下一个主要计划的 mypyc 特性之一。</p>
<p>相关更改：</p>
<ul class="simple">
<li><p>使用原生未包装的表示法来表示浮点数（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14880">14880</a>）。</p></li>
<li><p>文档中关于原生浮点数和整数的说明（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14927">14927</a>）。</p></li>
<li><p>修复浮点数到整数的转换（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14936">14936</a>）。</p></li>
</ul>
</section>
<section id="id102">
<h3>Mypyc：原生整数<a class="headerlink" href="#id102" title="Link to this heading">¶</a></h3>
<p>Mypyc 现在支持带符号的 32 位和 64 位整数类型，除了任意精度的 int 类型。您可以使用 mypy_extensions.i32 和 mypy_extensions.i64 来加速大量使用整数运算的代码。</p>
<p>简单示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mypy_extensions</span> <span class="kn">import</span> <span class="n">i64</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">i64</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">i64</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>有关更多信息，请参考 <a class="reference external" href="https://mypyc.readthedocs.io/en/latest/using_type_annotations.html#native-integer-types">文档</a>。此功能由 Jukka Lehtosalo 提供。</p>
</section>
<section id="id103">
<h3>其他 Mypyc 修复和改进<a class="headerlink" href="#id103" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>支持对 TypedDict 进行迭代（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14747">14747</a>）</p></li>
<li><p>不同元组类型之间的更快强制转换（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14899">14899</a>）</p></li>
<li><p>通过类型别名进行更快调用（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14784">14784</a>）</p></li>
<li><p>通过 cls 进行更快的类方法调用（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14789">14789</a>）</p></li>
</ul>
</section>
<section id="id104">
<h3>崩溃修复<a class="headerlink" href="#id104" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复协议定义中的类级导入崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14926">14926</a>）</p></li>
<li><p>修复单项联合别名的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14876">14876</a>）</p></li>
<li><p>修复增量模式下的 ParamSpec 崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14885">14885</a>）</p></li>
</ul>
</section>
<section id="id105">
<h3>文档更新<a class="headerlink" href="#id105" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>更新 1.0 版本的 --strict 文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14865">14865</a>）</p></li>
<li><p>一些小的文档调整（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14847">14847</a>）</p></li>
<li><p>改善 mypy 顶层的 disable-error-code 注释文档（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14810">14810</a>）</p></li>
</ul>
</section>
<section id="id106">
<h3>错误报告改进<a class="headerlink" href="#id106" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>向 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 建议添加错误代码（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14881">14881</a>）</p></li>
<li><p>为顶级 await 添加单独的错误代码（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14801">14801</a>）</p></li>
<li><p>不建议两个过时的存根包（Jelle Zijlstra，PR <a class="reference external" href="https://github.com/python/mypy/pull/14842">14842</a>）</p></li>
<li><p>为 pandas-stubs 和 lxml-stubs 添加建议（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14737">14737</a>）</p></li>
</ul>
</section>
<section id="id107">
<h3>其他修复和改进<a class="headerlink" href="#id107" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>多重继承将可调用对象视为函数的子类型（Christoph Tyralla，PR <a class="reference external" href="https://github.com/python/mypy/pull/14855">14855</a>）</p></li>
<li><p>stubtest：尊重 &#64;final 运行时装饰器并在存根中强制执行（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14922">14922</a>）</p></li>
<li><p>修复与 type[<type-var>] 相关的误报（sterliakov，PR <a class="reference external" href="https://github.com/python/mypy/pull/14756">14756</a>）</p></li>
<li><p>修复 ParamSpec 前缀的重复，并正确替换 ParamSpecs（EXPLOSION，PR <a class="reference external" href="https://github.com/python/mypy/pull/14677">14677</a>）</p></li>
<li><p>修复 <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> 错误报告为缺失的行号（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14893">14893</a>）</p></li>
<li><p>修复重载泛型的不可兼容重写（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14882">14882</a>）</p></li>
<li><p>允许在切片表达式中使用 SupportsIndex（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14738">14738</a>）</p></li>
<li><p>支持在使用 dataclass_transform 的数据类和类的主体中使用 if 语句（Jacek Chałupka，PR <a class="reference external" href="https://github.com/python/mypy/pull/14854">14854</a>）</p></li>
<li><p>允许可迭代类对象被解包（包括枚举）（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14827">14827</a>）</p></li>
<li><p>修复在 match 语句中使用海象表达式的缩小（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14844">14844</a>）</p></li>
<li><p>为 attr.evolve 添加签名（Ilya Konstantinov，PR <a class="reference external" href="https://github.com/python/mypy/pull/14526">14526</a>）</p></li>
<li><p>修复解包迭代器时的 Any 推断（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14821">14821</a>）</p></li>
<li><p>修复重载 <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> 方法的解包（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14817">14817</a>）</p></li>
<li><p>减小 mypy 缓存中的 JSON 数据大小（dosisod，PR <a class="reference external" href="https://github.com/python/mypy/pull/14808">14808</a>）</p></li>
<li><p>改进本地定义与全局定义同名时的“在定义之前使用”检查（Stas Ilinskiy，PR <a class="reference external" href="https://github.com/python/mypy/pull/14517">14517</a>）</p></li>
<li><p>尊重 NoReturn 作为 <strong>setitem</strong> 返回类型以标记不可达代码（sterliakov，PR <a class="reference external" href="https://github.com/python/mypy/pull/12572">12572</a>）</p></li>
</ul>
</section>
<section id="id108">
<h3>Typeshed 更新<a class="headerlink" href="#id108" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，除了标准库存根外，其余部分作为单独的 PyPI 包分发。有关 Typeshed 更改的完整列表，请参见 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=a544b75320e97424d2d927605316383c755cdac0+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a>。</p>
</section>
<section id="id109">
<h3>感谢名单<a class="headerlink" href="#id109" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Avasam</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>dosisod</p></li>
<li><p>EXPLOSION</p></li>
<li><p>Ilya Konstantinov</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jacek Chałupka</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Max Murin</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Richard Si</p></li>
<li><p>Shantanu</p></li>
<li><p>Stas Ilinskiy</p></li>
<li><p>sterliakov</p></li>
<li><p>Wesley Collin Wright</p></li>
</ul>
<p>发布者：Jukka Lehtosalo。</p>
</section>
</section>
<section id="mypy-1-1-1">
<h2>Mypy 1.1.1<a class="headerlink" href="#mypy-1-1-1" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/03/mypy-111-released.html">2023年3月6日</a></p>
<p>我们刚刚将 mypy 1.1.1 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 静态类型检查器。本次发布包含新特性、性能改进和错误修复。您可以使用以下命令安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读本次发布的完整文档。</p>
<section id="dataclass-transform">
<h3>对 <code class="docutils literal notranslate"><span class="pre">dataclass_transform</span></code> 的支持<a class="headerlink" href="#dataclass-transform" title="Link to this heading">¶</a></h3>
<p>此次发布新增对在 <a class="reference external" href="https://peps.python.org/pep-0681/#decorator-function-example">PEP 681</a> 中定义的 <code class="docutils literal notranslate"><span class="pre">dataclass_transform</span></code> 装饰器的全面支持。该功能允许生成 <code class="docutils literal notranslate"><span class="pre">__init__</span></code> 方法或其他方法的装饰器、基类和 metaclasses 基于类的属性（类似于数据类），以便 mypy 能够识别这些方法。此功能由 Wesley Collin Wright 提供。</p>
</section>
<section id="id110">
<h3>方法分配的专用错误代码<a class="headerlink" href="#id110" title="Link to this heading">¶</a></h3>
<p>由于 mypy 无法安全检查所有对方法的分配（即猴子补丁），因此默认情况下 mypy 会生成错误。为了更容易忽略该错误，mypy 现在使用新错误代码 <code class="docutils literal notranslate"><span class="pre">method-assign</span></code>。通过在文件中或全局禁用此错误代码，如果签名兼容，mypy 将不再对方法的分配发出警告。mypy 还支持旧的错误代码 <code class="docutils literal notranslate"><span class="pre">assignment</span></code>，以防止向后兼容性中断。此功能由 Ivan Levkivskyi 提供（PR <a class="reference external" href="https://github.com/python/mypy/pull/14570">14570</a>）。</p>
</section>
<section id="id111">
<h3>崩溃修复<a class="headerlink" href="#id111" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复类作用域中 comprehension 的海象运算符崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14556">14556</a>）</p></li>
<li><p>修复与值约束 TypeVar 相关的崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14642">14642</a>）</p></li>
</ul>
</section>
<section id="id112">
<h3>缓存损坏修复<a class="headerlink" href="#id112" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复泛型 TypedDict/NamedTuple 缓存（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14675">14675</a>）</p></li>
</ul>
</section>
<section id="id113">
<h3>Mypyc 修复和改进<a class="headerlink" href="#id113" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>减少“非特征基类必须优先…”错误的频率（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14468">14468</a>）</p></li>
<li><p>为布尔比较和算术生成更快的代码（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14489">14489</a>）</p></li>
<li><p>优化原生类的 <code class="docutils literal notranslate"><span class="pre">__enter__/__exit__</span></code>（Jared Hance，PR <a class="reference external" href="https://github.com/python/mypy/pull/14530">14530</a>）</p></li>
<li><p>检测属性定义是否与基类/特征冲突（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14535">14535</a>）</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">__divmod__</span></code> 和 <code class="docutils literal notranslate"><span class="pre">__rdivmod__</span></code> 魔法方法（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14613">14613</a>）</p></li>
<li><p>支持 <code class="docutils literal notranslate"><span class="pre">__pow__</span></code>, <code class="docutils literal notranslate"><span class="pre">__rpow__</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">__ipow__</span></code> 魔法方法（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14616">14616</a>）</p></li>
<li><p>修复解包到下划线的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14624">14624</a>）</p></li>
<li><p>修复对字典联合的迭代（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14713">14713</a>）</p></li>
</ul>
</section>
<section id="id114">
<h3>修复检测未定义名称（使用前定义）<a class="headerlink" href="#id114" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>正确处理海象运算符（Stas Ilinskiy，PR <a class="reference external" href="https://github.com/python/mypy/pull/14646">14646</a>）</p></li>
<li><p>正确处理匹配主体中的海象声明（Stas Ilinskiy，PR <a class="reference external" href="https://github.com/python/mypy/pull/14665">14665</a>）</p></li>
</ul>
</section>
<section id="id115">
<h3>Stubgen 改进<a class="headerlink" href="#id115" title="Link to this heading">¶</a></h3>
<p>Stubgen 是一个用于自动生成库草稿存根的工具。</p>
<ul class="simple">
<li><p>允许在顶层以下使用别名（Chad Dombrova，PR <a class="reference external" href="https://github.com/python/mypy/pull/14388">14388</a>）</p></li>
<li><p>修复 PEP 604 联合中的崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14557">14557</a>）</p></li>
<li><p>在生成的 .pyi 文件中保留 PEP 604 联合（hamdanal，PR <a class="reference external" href="https://github.com/python/mypy/pull/14601">14601</a>）</p></li>
</ul>
</section>
<section id="id116">
<h3>Stubtest 改进<a class="headerlink" href="#id116" title="Link to this heading">¶</a></h3>
<p>Stubtest 是一个用于测试存根是否符合实现的工具。</p>
<ul class="simple">
<li><p>更新消息格式，使其更易于定位错误位置（Avasam，PR <a class="reference external" href="https://github.com/python/mypy/pull/14437">14437</a>）</p></li>
<li><p>更好地处理名称改编边缘情况（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14596">14596</a>）</p></li>
</ul>
</section>
<section id="id117">
<h3>错误报告和消息的变化<a class="headerlink" href="#id117" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>添加新的 TypedDict 错误代码 <code class="docutils literal notranslate"><span class="pre">typeddict-unknown-key</span></code>（JoaquimEsteves，PR <a class="reference external" href="https://github.com/python/mypy/pull/14225">14225</a>）</p></li>
<li><p>在错误消息中为参数提供更合理的位置（Max Murin，PR <a class="reference external" href="https://github.com/python/mypy/pull/14562">14562</a>）</p></li>
<li><p>在错误消息中，仅引用模块的名称（Ilya Konstantinov，PR <a class="reference external" href="https://github.com/python/mypy/pull/14567">14567</a>）</p></li>
<li><p>改善关于 <code class="docutils literal notranslate"><span class="pre">Enum()</span></code> 的误导性消息（Rodrigo Silva，PR <a class="reference external" href="https://github.com/python/mypy/pull/14590">14590</a>）</p></li>
<li><p>如果定义不在 typing 中，建议从 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 导入（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14591">14591</a>）</p></li>
<li><p>一致使用 type-abstract 错误代码（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14619">14619</a>）</p></li>
<li><p>一致使用 TypedDict 的 literal-required 错误代码（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14621">14621</a>）</p></li>
<li><p>调整不一致的数据类插件错误消息（Wesley Collin Wright，PR <a class="reference external" href="https://github.com/python/mypy/pull/14637">14637</a>）</p></li>
<li><p>整合布尔字面值参数的错误消息（Wesley Collin Wright，PR <a class="reference external" href="https://github.com/python/mypy/pull/14693">14693</a>）</p></li>
</ul>
</section>
<section id="id118">
<h3>其他修复和改进<a class="headerlink" href="#id118" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>检查类型保护是否接受位置参数（EXPLOSION，PR <a class="reference external" href="https://github.com/python/mypy/pull/14238">14238</a>）</p></li>
<li><p>修复在 Container 和 Iterable 的联合上使用 in 运算符的错误（Max Murin，PR <a class="reference external" href="https://github.com/python/mypy/pull/14384">14384</a>）</p></li>
<li><p>通过 metaclass 支持类型[T] 的协议推断（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14554">14554</a>）</p></li>
<li><p>允许对字节类类型进行重叠比较（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14658">14658</a>）</p></li>
<li><p>修复 README 中的 mypy 守护进程文档链接（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14644">14644</a>）</p></li>
</ul>
</section>
<section id="id119">
<h3>Typeshed 更新<a class="headerlink" href="#id119" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，并作为单独的 PyPI 包分发，除了标准库存根。请查看 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=5ebf892d0710a6e87925b8d138dfa597e7bb11cc+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 获取 Typeshed 更改的完整列表。</p>
</section>
<section id="id120">
<h3>鸣谢<a class="headerlink" href="#id120" title="Link to this heading">¶</a></h3>
<p>感谢所有为本次发布贡献的 mypy 开发者：</p>
<ul class="simple">
<li><p>Alex Waygood</p></li>
<li><p>Avasam</p></li>
<li><p>Chad Dombrova</p></li>
<li><p>dosisod</p></li>
<li><p>EXPLOSION</p></li>
<li><p>hamdanal</p></li>
<li><p>Ilya Konstantinov</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jared Hance</p></li>
<li><p>JoaquimEsteves</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Max Murin</p></li>
<li><p>Michael Lee</p></li>
<li><p>Michael R. Crusoe</p></li>
<li><p>Richard Si</p></li>
<li><p>Rodrigo Silva</p></li>
<li><p>Shantanu</p></li>
<li><p>Stas Ilinskiy</p></li>
<li><p>Wesley Collin Wright</p></li>
<li><p>Yilei &quot;Dolee&quot; Yang</p></li>
<li><p>Yurii Karabas</p></li>
</ul>
<p>我们还要感谢我们的雇主 Dropbox，为 mypy 核心团队提供资金支持。</p>
<p>发布者：Max Murin</p>
</section>
</section>
<hr class="docutils" />
<section id="mypy-1-0">
<h2>Mypy 1.0<a class="headerlink" href="#mypy-1-0" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mypy-lang.blogspot.com/2023/02/mypy-10-released.html">2023年2月6日</a></p>
<p>我们刚刚将 mypy 1.0 上传到 Python 包索引（<a class="reference external" href="https://pypi.org/project/mypy/">PyPI</a>）。Mypy 是一个 Python 静态类型检查器。本次发布包含新特性、性能改进和错误修复。您可以使用以下命令安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>mypy
</pre></div>
</div>
<p>您可以在 <a class="reference external" href="http://mypy.readthedocs.io">Read the Docs</a> 上阅读本次发布的完整文档。</p>
<section id="id121">
<h3>新的发布版本方案<a class="headerlink" href="#id121" title="Link to this heading">¶</a></h3>
<p>现在 mypy 达到 1.0，我们将切换到新的版本方案。Mypy 的版本号将采用 x.y.z 形式。</p>
<p>规则：</p>
<ul class="simple">
<li><p>如果特性发布包含显著的向后不兼容更改，且影响大量用户，则主版本号（x）递增。</p></li>
<li><p>每个特性发布都递增次版本号（y）。次版本发布包括来自 Typeshed 的标准库存根更新。</p></li>
<li><p>仅在有修复时递增点版本号（z）。</p></li>
</ul>
<p>Mypy 不使用 SemVer，因为大多数次版本发布至少具有 Typeshed 中的轻微向后不兼容更改。此外，许多类型检查特性会在代码中发现新的合法问题。这些不会被视为向后不兼容的更改，除非新错误的数量非常高。</p>
<p>任何显著的向后不兼容更改必须在前一次特性发布的博客文章中宣布，才能进行更改。前一个版本还必须提供一个标志以显式启用或禁用新行为（在可行的情况下），以便用户能够为更改做准备并报告问题。我们应在切换默认设置后至少保留该特性标志几个版本。</p>
<p>有关版本方案的详细信息和最新版本，请参见 <a class="reference external" href="https://github.com/python/mypy/wiki/Release-Process">mypy wiki 中的“发布过程”</a>。</p>
</section>
<section id="id122">
<h3>性能改进<a class="headerlink" href="#id122" title="Link to this heading">¶</a></h3>
<p>Mypy 1.0 比 mypy 0.991 在 Dropbox 内部代码库的类型检查速度提高了多达 40%。我们还建立了一个每日作业来测量最新开发版本的性能，方便跟踪性能变化。</p>
<p>许多优化推动了这一改进：</p>
<ul class="simple">
<li><p>提高在具有多个属性的类上的错误性能（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14379">14379</a>）</p></li>
<li><p>加速 make_simplified_union（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14370">14370</a>）</p></li>
<li><p>微优化 get_proper_type(s)（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14369">14369</a>）</p></li>
<li><p>微优化 flatten_nested_unions（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14368">14368</a>）</p></li>
<li><p>一些语义分析器的微优化（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14367">14367</a>）</p></li>
<li><p>其他微优化（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14366">14366</a>）</p></li>
<li><p>优化：避免语义分析器中对上下文管理器的几次使用（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14360">14360</a>）</p></li>
<li><p>优化：在类型子类中启用始终定义的属性（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14356">14356</a>）</p></li>
<li><p>优化：移除类型分析器中的昂贵上下文管理器（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14357">14357</a>）</p></li>
<li><p>子类型：Union/Union 子类型检查的快速路径（Hugues，PR <a class="reference external" href="https://github.com/python/mypy/pull/14277">14277</a>）</p></li>
<li><p>微优化：避免导致不必要装箱的 Bogus[int] 类型（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14354">14354</a>）</p></li>
<li><p>避免在未向用户显示错误时执行缓慢的错误消息逻辑（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14336">14336</a>）</p></li>
<li><p>加速 hasattr() 检查的实现（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14333">14333</a>）</p></li>
<li><p>避免在热代码路径中使用上下文管理器（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14331">14331</a>）</p></li>
<li><p>将各种类型查询更改为更快的布尔类型查询（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14330">14330</a>）</p></li>
<li><p>加速递归类型检查（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14326">14326</a>）</p></li>
<li><p>通过避免嵌套函数优化子类型检查（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14325">14325</a>）</p></li>
<li><p>优化子类型检查中的类型参数检查（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14324">14324</a>）</p></li>
<li><p>加速刷新类型变量（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14323">14323</a>）</p></li>
<li><p>为 **kwds 优化 TypedDict 类型的实现（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14316">14316</a>）</p></li>
</ul>
</section>
<section id="id123">
<h3>提醒使用未定义的变量<a class="headerlink" href="#id123" title="Link to this heading">¶</a></h3>
<p>如果在定义之前使用变量，Mypy 现在将生成错误。此功能默认启用。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># E: Name &quot;x&quot; is used before definition [used-before-def]</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>此功能由 Stas Ilinskiy 贡献。</p>
</section>
<section id="id124">
<h3>检测可能未定义的变量（实验性）<a class="headerlink" href="#id124" title="Link to this heading">¶</a></h3>
<p>现在提供一个新的实验性可能未定义错误代码，可以检测可能未定义的变量：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Error: Name &quot;x&quot; may be undefined [possibly-undefined]</span>
</pre></div>
</div>
<p>该错误代码默认禁用，因为它可能产生误报。此功能由 Stas Ilinskiy 贡献。</p>
</section>
<section id="self">
<h3>支持 “Self” 类型<a class="headerlink" href="#self" title="Link to this heading">¶</a></h3>
<p>现在有一种更简单的语法来声明 <a class="reference external" href="https://mypy.readthedocs.io/en/stable/generics.html#generic-methods-and-generic-self">泛型自类型</a>，该类型在 <a class="reference external" href="https://peps.python.org/pep-0673/">PEP 673</a> 中引入。您不再需要定义类型变量来使用“自类型”，并且可以将其与属性一起使用。以下是 mypy 文档中的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="k">class</span> <span class="nc">Friend</span><span class="p">:</span>
    <span class="n">other</span><span class="p">:</span> <span class="n">Self</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_pair</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">Self</span><span class="p">]:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(),</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

<span class="k">class</span> <span class="nc">SuperFriend</span><span class="p">(</span><span class="n">Friend</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># a 和 b 的推断类型为 &quot;SuperFriend&quot;，而不是 &quot;Friend&quot;</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">SuperFriend</span><span class="o">.</span><span class="n">make_pair</span><span class="p">()</span>
</pre></div>
</div>
<p>此功能在 Python 3.11 中引入。在早期的 Python 版本中，可以在 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 中使用 Self 的回溯版本。</p>
<p>此功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/14041">14041</a>）。</p>
</section>
<section id="id125">
<h3>支持在类型别名中使用 ParamSpec<a class="headerlink" href="#id125" title="Link to this heading">¶</a></h3>
<p>现在可以在类型别名中使用 ParamSpec 和 Concatenate。示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ParamSpec</span><span class="p">,</span> <span class="n">Callable</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">A</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>此功能由 Ivan Levkivskyi 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/14159">14159</a>）。</p>
</section>
<section id="id126">
<h3>ParamSpec 和泛型自类型不再是实验性<a class="headerlink" href="#id126" title="Link to this heading">¶</a></h3>
<p>对 ParamSpec（<a class="reference external" href="https://www.python.org/dev/peps/pep-0612/">PEP 612</a>）和泛型自类型的支持不再被视为实验性。</p>
</section>
<section id="id127">
<h3>其他新功能<a class="headerlink" href="#id127" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>数据类转换的最小部分实现（<a class="reference external" href="https://peps.python.org/pep-0681/">PEP 681</a>）（Wesley Collin Wright，PR <a class="reference external" href="https://github.com/python/mypy/pull/14523">14523</a>）</p></li>
<li><p>添加对 <code class="docutils literal notranslate"><span class="pre">typing_extensions.TypeVar</span></code> 的基本支持（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14313">14313</a>）</p></li>
<li><p>添加 <code class="docutils literal notranslate"><span class="pre">--debug-serialize</span></code> 选项（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14155">14155</a>）</p></li>
<li><p>常量折叠最终变量的初始化（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14283">14283</a>）</p></li>
<li><p>启用 attrs 的 Final 实例属性（Tin Tvrtković，PR <a class="reference external" href="https://github.com/python/mypy/pull/14232">14232</a>）</p></li>
<li><p>允许函数参数作为基类（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14135">14135</a>）</p></li>
<li><p>允许与混合协议一起使用 super()（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14082">14082</a>）</p></li>
<li><p>添加 dict.keys 会员的类型推断（Matthew Hughes，PR <a class="reference external" href="https://github.com/python/mypy/pull/13372">13372</a>）</p></li>
<li><p>如果属性使用 <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> 定义，则为类属性访问生成错误（Harrison McCarty，PR <a class="reference external" href="https://github.com/python/mypy/pull/14125">14125</a>）</p></li>
<li><p>支持回调协议中的其他属性（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14084">14084</a>）</p></li>
</ul>
</section>
<section id="id128">
<h3>修复崩溃问题<a class="headerlink" href="#id128" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>修复使用前向引用的前缀 ParamSpec 崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14569">14569</a>）</p></li>
<li><p>修复在解析相同的部分类型两次时的内部崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14552">14552</a>）</p></li>
<li><p>修复在新导入循环中的守护进程模式崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14508">14508</a>）</p></li>
<li><p>修复 mypy 守护进程崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14497">14497</a>）</p></li>
<li><p>修复增量模式下 Any 元类的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14495">14495</a>）</p></li>
<li><p>修复在函数外的推导中使用 await 的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14486">14486</a>）</p></li>
<li><p>修复在上界的前向引用中使用 Self 类型的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14206">14206</a>）</p></li>
<li><p>修复在方法外使用不正确的 super() 时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14208">14208</a>）</p></li>
<li><p>修复使用冻结 attrs 时的覆盖崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14186">14186</a>）</p></li>
<li><p>修复在嵌套位置出现泛型函数时的增量模式崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14148">14148</a>）</p></li>
<li><p>修复格式错误的 NamedTuple 导致的守护进程崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14119">14119</a>）</p></li>
<li><p>修复 ParamSpec 推导中的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14118">14118</a>）</p></li>
<li><p>修复嵌套泛型可调用对象的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14093">14093</a>）</p></li>
<li><p>修复解包语法错误引发的崩溃（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/11499">11499</a>）</p></li>
<li><p>修复在 lambda 内部进行部分类型推导时的崩溃（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14087">14087</a>）</p></li>
<li><p>修复与枚举的崩溃（Michael Lee，PR <a class="reference external" href="https://github.com/python/mypy/pull/14021">14021</a>）</p></li>
<li><p>修复格式错误的 TypedDict 和 disallow-any-expr 的崩溃（Michael Lee，PR <a class="reference external" href="https://github.com/python/mypy/pull/13963">13963</a>）</p></li>
</ul>
</section>
<section id="id129">
<h3>错误报告改进<a class="headerlink" href="#id129" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>对缺少 self 的错误提供更有帮助的信息（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14386">14386</a>）</p></li>
<li><p>添加错误代码 truthy-iterable（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/13762">13762</a>）</p></li>
<li><p>修复错误消息中的复数形式（KotlinIsland，PR <a class="reference external" href="https://github.com/python/mypy/pull/14411">14411</a>）</p></li>
</ul>
</section>
<section id="mypyc-match">
<h3>Mypyc：支持 match 语句<a class="headerlink" href="#mypyc-match" title="Link to this heading">¶</a></h3>
<p>Mypyc 现在可以编译 Python 3.10 的 match 语句。</p>
<p>此功能由 dosisod 贡献（PR <a class="reference external" href="https://github.com/python/mypy/pull/13953">13953</a>）。</p>
</section>
<section id="id130">
<h3>其他 Mypyc 修复和改进<a class="headerlink" href="#id130" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>优化原生类实例的 int(x)/float(x)/complex(x)（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14450">14450</a>）</p></li>
<li><p>始终发出警告（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14451">14451</a>）</p></li>
<li><p>更快的布尔和整数转换（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14422">14422</a>）</p></li>
<li><p>支持覆盖属性的属性（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14377">14377</a>）</p></li>
<li><p>预计算“in”操作和迭代的集合字面量（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14409">14409</a>）</p></li>
<li><p>设置非扩展类的 <code class="docutils literal notranslate"><span class="pre">__all__</span></code> 时不加载带前向引用的目标（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14401">14401</a>）</p></li>
<li><p>编译去除 NewType 类型调用（Richard Si，PR <a class="reference external" href="https://github.com/python/mypy/pull/14398">14398</a>）</p></li>
<li><p>改进多重继承的错误消息（Joshua Bronson，PR <a class="reference external" href="https://github.com/python/mypy/pull/14344">14344</a>）</p></li>
<li><p>简化联合类型（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14363">14363</a>）</p></li>
<li><p>修复联合简化的相关问题（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14364">14364</a>）</p></li>
<li><p>针对 typeshed 对 Collection 的更改的修复（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/13994">13994</a>）</p></li>
<li><p>允许使用 enum.Enum（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/13995">13995</a>）</p></li>
<li><p>修复在 Arch Linux 上的编译问题（dosisod，PR <a class="reference external" href="https://github.com/python/mypy/pull/13978">13978</a>）</p></li>
</ul>
</section>
<section id="id131">
<h3>文档改进<a class="headerlink" href="#id131" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>各种文档和错误消息调整（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14574">14574</a>）</p></li>
<li><p>改进泛型文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14587">14587</a>）</p></li>
<li><p>改进协议文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14577">14577</a>）</p></li>
<li><p>改进动态类型文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14576">14576</a>）</p></li>
<li><p>改进常见问题页面（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14581">14581</a>）</p></li>
<li><p>添加顶级 TypedDict 页面（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14584">14584</a>）</p></li>
<li><p>改进入门文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14572">14572</a>）</p></li>
<li><p>将 truthy-function 文档从“可选检查”移至“默认启用”（Anders Kaseorg，PR <a class="reference external" href="https://github.com/python/mypy/pull/14380">14380</a>）</p></li>
<li><p>避免在装饰器工厂文档中使用隐式可选（Tom Schraitle，PR <a class="reference external" href="https://github.com/python/mypy/pull/14156">14156</a>）</p></li>
<li><p>澄清有关 install-types 的文档（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14003">14003</a>）</p></li>
<li><p>改善模块级类型忽略错误的可搜索性（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14342">14342</a>）</p></li>
<li><p>在 README 中宣传 mypy 守护进程（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14248">14248</a>）</p></li>
<li><p>在 README 中添加错误代码的链接（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14249">14249</a>）</p></li>
<li><p>文档说明报告生成会禁用缓存（Ilya Konstantinov，PR <a class="reference external" href="https://github.com/python/mypy/pull/14402">14402</a>）</p></li>
<li><p>停止称 mypy 为测试软件（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14251">14251</a>）</p></li>
<li><p>Flycheck-mypy 被弃用，因为其功能已合并到 Flycheck（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14247">14247</a>）</p></li>
<li><p>更新“声明装饰器”中的代码示例（ChristianWitzler，PR <a class="reference external" href="https://github.com/python/mypy/pull/14131">14131</a>）</p></li>
</ul>
</section>
<section id="id132">
<h3>Stubtest 改进<a class="headerlink" href="#id132" title="Link to this heading">¶</a></h3>
<p>Stubtest 是一个用于测试存根是否符合实现的工具。</p>
<ul class="simple">
<li><p>改进与 <code class="docutils literal notranslate"><span class="pre">__all__</span></code> 相关错误的错误消息（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14362">14362</a>）</p></li>
<li><p>改进确定全局命名空间名称是否被导入的启发式（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14270">14270</a>）</p></li>
<li><p>捕获模块导入时的 BaseException（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14284">14284</a>）</p></li>
<li><p>将导出符号错误与 <code class="docutils literal notranslate"><span class="pre">__all__</span></code> 对象路径关联（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14217">14217</a>）</p></li>
<li><p>将 <code class="docutils literal notranslate"><span class="pre">__warningregistry__</span></code> 添加到忽略的模块 dunder 列表（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14218">14218</a>）</p></li>
<li><p>如果存根中存在默认值，则检查其正确性（Jelle Zijlstra，PR <a class="reference external" href="https://github.com/python/mypy/pull/14085">14085</a>）</p></li>
</ul>
</section>
<section id="id133">
<h3>Stubgen 改进<a class="headerlink" href="#id133" title="Link to this heading">¶</a></h3>
<p>Stubgen 是一个用于自动生成库草稿存根的工具。</p>
<ul class="simple">
<li><p>将 dll 视为 C 模块（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14503">14503</a>）</p></li>
</ul>
</section>
<section id="id134">
<h3>其他显著修复和改进<a class="headerlink" href="#id134" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>根据最近的 typeshed 更改更新存根建议（Alex Waygood，PR <a class="reference external" href="https://github.com/python/mypy/pull/14265">14265</a>）</p></li>
<li><p>修复带缓存的 attrs 协议检查（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14558">14558</a>）</p></li>
<li><p>修复操作数项类型具有自定义 <code class="docutils literal notranslate"><span class="pre">__eq__</span></code> 的严格相等检查（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14513">14513</a>）</p></li>
<li><p>不要认为对象总是为真（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14510">14510</a>）</p></li>
<li><p>正确支持 TypedDict 的联合作为字典字面量上下文（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14505">14505</a>）</p></li>
<li><p>正确扩展使用 Self 和 TypeVar 的泛型类中的类型（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14491">14491</a>）</p></li>
<li><p>修复使用调用语法定义的递归 TypedDicts/NamedTuples（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14488">14488</a>）</p></li>
<li><p>修复类继承 Any 时的类型推断问题（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14404">14404</a>）</p></li>
<li><p>修复涉及六个的泛型基类的误报（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14478">14478</a>）</p></li>
<li><p>在命名空间模式下，不要将没有扩展名的脚本视为模块（Tim Geypens，PR <a class="reference external" href="https://github.com/python/mypy/pull/14335">14335</a>）</p></li>
<li><p>修复联合中的受限类型变量的推断（Christoph Tyralla，PR <a class="reference external" href="https://github.com/python/mypy/pull/14396">14396</a>）</p></li>
<li><p>修复从 typing 导入的 Unpack（Marc Mueller，PR <a class="reference external" href="https://github.com/python/mypy/pull/14378">14378</a>）</p></li>
<li><p>允许多行值的 ini 配置中使用尾随逗号（Nikita Sobolev，PR <a class="reference external" href="https://github.com/python/mypy/pull/14240">14240</a>）</p></li>
<li><p>修复涉及 Unions 和生成器或协程的假阴性（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14224">14224</a>）</p></li>
<li><p>修复可调用的类型参数约束（Vincent Vanlaer，PR <a class="reference external" href="https://github.com/python/mypy/pull/14153">14153</a>）</p></li>
<li><p>修复具有固定长度元组的类型别名（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14184">14184</a>）</p></li>
<li><p>修复类型别名和新样式联合的相关问题（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14181">14181</a>）</p></li>
<li><p>简化联合的方式不再过于激进（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14178">14178</a>）</p></li>
<li><p>简化可调用重叠逻辑（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14174">14174</a>）</p></li>
<li><p>在将值赋给联合类型变量时尝试空上下文（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14151">14151</a>）</p></li>
<li><p>改进递归类型处理（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14147">14147</a>）</p></li>
<li><p>使非数字非空的 FORCE_COLOR 变量为真（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14140">14140</a>）</p></li>
<li><p>修复递归类型别名的问题（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14136">14136</a>）</p></li>
<li><p>正确处理 Python 3.11 上的 Enum 名称（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14133">14133</a>）</p></li>
<li><p>修复类对象回退到元类的回调协议（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14121">14121</a>）</p></li>
<li><p>正确支持可调用的 ClassVar 中的 self 类型（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14115">14115</a>）</p></li>
<li><p>修复嵌套位置和属性中的类型变量冲突（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14095">14095</a>）</p></li>
<li><p>允许类变量作为只读属性的实现（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14081">14081</a>）</p></li>
<li><p>防止警告导致 dmypy 失败（Andrzej Bartosiński，PR <a class="reference external" href="https://github.com/python/mypy/pull/14102">14102</a>）</p></li>
<li><p>正确处理 mypy 守护进程中的嵌套定义（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14104">14104</a>）</p></li>
<li><p>如果可能存在提升，不要认为分支是不可达的（Ivan Levkivskyi，PR <a class="reference external" href="https://github.com/python/mypy/pull/14077">14077</a>）</p></li>
<li><p>修复具体子类中重载方法的不兼容重写（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14017">14017</a>）</p></li>
<li><p>修复类型别名中的新样式联合语法（Jukka Lehtosalo，PR <a class="reference external" href="https://github.com/python/mypy/pull/14008">14008</a>）</p></li>
<li><p>修复和优化重载兼容性检查（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/14018">14018</a>）</p></li>
<li><p>改进通过导入处理重定义的方式（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/13969">13969</a>）</p></li>
<li><p>保留（某些）隐式导出的类型（Shantanu，PR <a class="reference external" href="https://github.com/python/mypy/pull/13967">13967</a>）</p></li>
</ul>
</section>
<section id="id135">
<h3>Typeshed 更新<a class="headerlink" href="#id135" title="Link to this heading">¶</a></h3>
<p>Typeshed 现在是模块化的，除了标准库存根之外的所有内容都以单独的 PyPI 包分发。请参阅 <a class="reference external" href="https://github.com/python/typeshed/commits/main?after=ea0ae2155e8a04c9837903c3aff8dd5ad5f36ebc+0&amp;amp;branch=main&amp;amp;path=stdlib">git log</a> 获取 typeshed 更改的完整列表。</p>
</section>
<section id="id136">
<h3>致谢<a class="headerlink" href="#id136" title="Link to this heading">¶</a></h3>
<p>感谢所有为此版本做出贡献的 mypy 贡献者：</p>
<ul class="simple">
<li><p>Alessio Izzo</p></li>
<li><p>Alex Waygood</p></li>
<li><p>Anders Kaseorg</p></li>
<li><p>Andrzej Bartosiński</p></li>
<li><p>Avasam</p></li>
<li><p>ChristianWitzler</p></li>
<li><p>Christoph Tyralla</p></li>
<li><p>dosisod</p></li>
<li><p>Harrison McCarty</p></li>
<li><p>Hugo van Kemenade</p></li>
<li><p>Hugues</p></li>
<li><p>Ilya Konstantinov</p></li>
<li><p>Ivan Levkivskyi</p></li>
<li><p>Jelle Zijlstra</p></li>
<li><p>jhance</p></li>
<li><p>johnthagen</p></li>
<li><p>Jonathan Daniel</p></li>
<li><p>Joshua Bronson</p></li>
<li><p>Jukka Lehtosalo</p></li>
<li><p>KotlinIsland</p></li>
<li><p>Lakshay Bisht</p></li>
<li><p>Lefteris Karapetsas</p></li>
<li><p>Marc Mueller</p></li>
<li><p>Matthew Hughes</p></li>
<li><p>Michael Lee</p></li>
<li><p>Nick Drozd</p></li>
<li><p>Nikita Sobolev</p></li>
<li><p>Richard Si</p></li>
<li><p>Shantanu</p></li>
<li><p>Stas Ilinskiy</p></li>
<li><p>Tim Geypens</p></li>
<li><p>Tin Tvrtković</p></li>
<li><p>Tom Schraitle</p></li>
<li><p>Valentin Stanciu</p></li>
<li><p>Vincent Vanlaer</p></li>
</ul>
<p>我们还要感谢我们的雇主 Dropbox，资助了 mypy 核心团队的工作。</p>
<p>由 Stas Ilinskiy 发布</p>
</section>
</section>
<section id="id137">
<h2>以前的版本<a class="headerlink" href="#id137" title="Link to this heading">¶</a></h2>
<p>有关以前版本的信息，请参阅 <a class="reference external" href="https://mypy-lang.blogspot.com/">此处</a>。</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="faq.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">常见问题解答(Frequently Asked Questions)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2012-2022 Jukka Lehtosalo and mypy contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Mypy 版本说明</a><ul>
<li><a class="reference internal" href="#id1">下一个版本</a></li>
<li><a class="reference internal" href="#mypy-1-12">Mypy 1.12</a><ul>
<li><a class="reference internal" href="#python-3-12-pep-695">支持 Python 3.12 的泛型语法（PEP 695）</a></li>
<li><a class="reference internal" href="#python-3-13">对 Python 3.13 的基本支持</a></li>
<li><a class="reference internal" href="#mypyc-python-3-13">Mypyc 对 Python 3.13 的支持</a></li>
<li><a class="reference internal" href="#id2">推断条件表达式的联合类型</a></li>
<li><a class="reference internal" href="#typeddict-readonly-pep-705">对 TypedDict 的 ReadOnly 支持 (PEP 705)</a></li>
<li><a class="reference internal" href="#python-3-8">Python 3.8 结束支持在即</a></li>
<li><a class="reference internal" href="#id3">默认设置的计划更改</a></li>
<li><a class="reference internal" href="#id4">文档更新</a></li>
<li><a class="reference internal" href="#typeddict">实验性内联 TypedDict 语法</a></li>
<li><a class="reference internal" href="#stubgen">Stubgen 改进</a></li>
<li><a class="reference internal" href="#stubtest">Stubtest 改进</a></li>
<li><a class="reference internal" href="#id5">其他显著修复和改进</a></li>
<li><a class="reference internal" href="#mypy-1-12-1">Mypy 1.12.1</a></li>
<li><a class="reference internal" href="#id6">类型仓库更新</a></li>
<li><a class="reference internal" href="#id7">致谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-11">Mypy 1.11</a><ul>
<li><a class="reference internal" href="#id8">支持 Python 3.12 的泛型语法（PEP 695）</a></li>
<li><a class="reference internal" href="#functools-partial">支持 <code class="docutils literal notranslate"><span class="pre">functools.partial</span></code></a></li>
<li><a class="reference internal" href="#id9">对未类型化重写的更严格检查</a></li>
<li><a class="reference internal" href="#id10">类型推断的改进</a></li>
<li><a class="reference internal" href="#id11">重载重叠检测的改进</a></li>
<li><a class="reference internal" href="#id12">更好的表达式中的类型提示支持</a></li>
<li><a class="reference internal" href="#mypyc">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id13">Stubtest 的更改</a></li>
<li><a class="reference internal" href="#id14">Stubgen 的更改</a></li>
<li><a class="reference internal" href="#id15">杂项新功能</a></li>
<li><a class="reference internal" href="#id16">错误报告的更改</a></li>
<li><a class="reference internal" href="#id17">崩溃修复</a></li>
<li><a class="reference internal" href="#id18">文档更改</a></li>
<li><a class="reference internal" href="#id19">其他显著改进和修复</a></li>
<li><a class="reference internal" href="#typeshed">Typeshed 更新</a></li>
<li><a class="reference internal" href="#mypy-1-11-1">Mypy 1.11.1</a></li>
<li><a class="reference internal" href="#mypy-1-11-2">Mypy 1.11.2</a></li>
<li><a class="reference internal" href="#id20">致谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-10">Mypy 1.10</a><ul>
<li><a class="reference internal" href="#typeis-pep-742">支持 TypeIs (PEP 742)</a></li>
<li><a class="reference internal" href="#typevar-pep-696">支持 TypeVar 默认值 (PEP 696)</a></li>
<li><a class="reference internal" href="#typealiastype-pep-695">支持 TypeAliasType (PEP 695)</a></li>
<li><a class="reference internal" href="#unsafe-super">检测额外的 unsafe super() 使用</a></li>
<li><a class="reference internal" href="#id21">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id22">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id23">文档改进</a></li>
<li><a class="reference internal" href="#id24">错误报告改进</a></li>
<li><a class="reference internal" href="#id25">其他显著变化和修复</a></li>
<li><a class="reference internal" href="#id26">Typeshed 更新</a></li>
<li><a class="reference internal" href="#mypy-1-10-1">Mypy 1.10.1</a></li>
<li><a class="reference internal" href="#id27">感谢名单</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-9">Mypy 1.9</a><ul>
<li><a class="reference internal" href="#id28">破坏性变更</a></li>
<li><a class="reference internal" href="#pep-696">对类型参数默认值的基本支持（PEP 696）</a></li>
<li><a class="reference internal" href="#id29">类型检查改进</a></li>
<li><a class="reference internal" href="#id30">性能改进</a></li>
<li><a class="reference internal" href="#id31">文档更新</a></li>
<li><a class="reference internal" href="#id32">Stubtest 改进</a></li>
<li><a class="reference internal" href="#id33">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id34">感谢致辞</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-8">Mypy 1.8</a><ul>
<li><a class="reference internal" href="#id35">类型检查改进</a></li>
<li><a class="reference internal" href="#id36">性能改进</a></li>
<li><a class="reference internal" href="#id37">错误报告改进</a></li>
<li><a class="reference internal" href="#id38">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id39">Stubtest 改进</a></li>
<li><a class="reference internal" href="#id40">崩溃修复</a></li>
<li><a class="reference internal" href="#id41">文档更新</a></li>
<li><a class="reference internal" href="#id42">其他显著变化和修复</a></li>
<li><a class="reference internal" href="#id43">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id44">感谢致辞</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-7">Mypy 1.7</a><ul>
<li><a class="reference internal" href="#typeddict-kwargs">使用 TypedDict 进行 <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> 类型注解</a></li>
<li><a class="reference internal" href="#typevartuple">TypeVarTuple 支持已启用（实验性）</a></li>
<li><a class="reference internal" href="#id45">安装 Mypyc 依赖的新方式</a></li>
<li><a class="reference internal" href="#id46">重新导出的新规则</a></li>
<li><a class="reference internal" href="#id47">改进的类型推断</a></li>
<li><a class="reference internal" href="#len">使用 len() 缩小元组类型</a></li>
<li><a class="reference internal" href="#id48">更精确的元组长度（实验性）</a></li>
<li><a class="reference internal" href="#id49">Mypy 更新日志</a></li>
<li><a class="reference internal" href="#id50">Mypy 守护进程改进</a></li>
<li><a class="reference internal" href="#id51">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id52">错误报告改进</a></li>
<li><a class="reference internal" href="#id53">性能改进</a></li>
<li><a class="reference internal" href="#attrs">Attrs 和数据类改进</a></li>
<li><a class="reference internal" href="#id54">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id55">崩溃修复</a></li>
<li><a class="reference internal" href="#id56">文档更新</a></li>
<li><a class="reference internal" href="#id57">其他显著变化和修复</a></li>
<li><a class="reference internal" href="#id58">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id59">致谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-6">Mypy 1.6</a><ul>
<li><a class="reference internal" href="#id60">引入导入错误的错误子代码</a></li>
<li><a class="reference internal" href="#python-3-6">删除对 Python 3.6 及更早版本的支持</a></li>
<li><a class="reference internal" href="#disallow-untyped-calls">选择性过滤 <code class="docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code> 目标</a></li>
<li><a class="reference internal" href="#id61">改进的可调用类型之间的类型推断</a></li>
<li><a class="reference internal" href="#none-typevar">不再将 None 和 TypeVar 视为重载中的重叠</a></li>
<li><a class="reference internal" href="#new-type-inference">对 <code class="docutils literal notranslate"><span class="pre">--new-type-inference</span></code> 的改进</a></li>
<li><a class="reference internal" href="#paramspec">ParamSpec 的改进</a></li>
<li><a class="reference internal" href="#id62">Stubgen 的改进</a></li>
<li><a class="reference internal" href="#id63">Stubtest 的改进</a></li>
<li><a class="reference internal" href="#id64">文档的改进</a></li>
<li><a class="reference internal" href="#id65">其他显著变化和修复</a></li>
<li><a class="reference internal" href="#id66">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id67">致谢</a></li>
<li><a class="reference internal" href="#mypy-1-5">Mypy 1.5</a></li>
<li><a class="reference internal" href="#python-3-7">删除对 Python 3.7 的支持</a></li>
<li><a class="reference internal" href="#override">可选检查以强制要求显式 &#64;override</a></li>
<li><a class="reference internal" href="#id68">更灵活的 TypedDict 创建和更新</a></li>
<li><a class="reference internal" href="#strict-concatenate">弃用标志：<code class="docutils literal notranslate"><span class="pre">--strict-concatenate</span></code></a></li>
<li><a class="reference internal" href="#id69">可选显示错误代码文档链接</a></li>
<li><a class="reference internal" href="#id70">一致地避免对不可达代码进行类型检查</a></li>
<li><a class="reference internal" href="#id71">实验性改进的泛型函数类型推断</a></li>
<li><a class="reference internal" href="#python-3-12">对 Python 3.12 的部分支持</a></li>
<li><a class="reference internal" href="#id72">数据类改进</a></li>
<li><a class="reference internal" href="#id73">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id74">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id75">文档更新</a></li>
<li><a class="reference internal" href="#id76">其他显著修复和改进</a></li>
<li><a class="reference internal" href="#id77">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id78">致谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-4">Mypy 1.4</a><ul>
<li><a class="reference internal" href="#id79">重写装饰器</a></li>
<li><a class="reference internal" href="#id80">向嵌套函数传播类型收窄</a></li>
<li><a class="reference internal" href="#id81">使用“==”收窄枚举值</a></li>
<li><a class="reference internal" href="#id82">性能改进</a></li>
<li><a class="reference internal" href="#id83">插件改进</a></li>
<li><a class="reference internal" href="#id84">崩溃修复</a></li>
<li><a class="reference internal" href="#id85">错误消息改进</a></li>
<li><a class="reference internal" href="#id86">文档更新</a></li>
<li><a class="reference internal" href="#id87">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id88">Stubgen 变更</a></li>
<li><a class="reference internal" href="#id89">其他显著修复和改进</a></li>
<li><a class="reference internal" href="#id90">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id91">致谢</a></li>
<li><a class="reference internal" href="#mypy-1-3">Mypy 1.3</a></li>
<li><a class="reference internal" href="#id92">性能改进</a></li>
<li><a class="reference internal" href="#stub">Stub 工具改进</a></li>
<li><a class="reference internal" href="#id93">attrs 改进</a></li>
<li><a class="reference internal" href="#id94">文档更新</a></li>
<li><a class="reference internal" href="#id95">错误报告改进</a></li>
<li><a class="reference internal" href="#id96">Mypyc 改进</a></li>
<li><a class="reference internal" href="#id97">其他修复和改进</a></li>
<li><a class="reference internal" href="#id98">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id99">感谢名单</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-2">Mypy 1.2</a><ul>
<li><a class="reference internal" href="#id100">数据类转换的改进</a></li>
<li><a class="reference internal" href="#id101">Mypyc：原生浮点数</a></li>
<li><a class="reference internal" href="#id102">Mypyc：原生整数</a></li>
<li><a class="reference internal" href="#id103">其他 Mypyc 修复和改进</a></li>
<li><a class="reference internal" href="#id104">崩溃修复</a></li>
<li><a class="reference internal" href="#id105">文档更新</a></li>
<li><a class="reference internal" href="#id106">错误报告改进</a></li>
<li><a class="reference internal" href="#id107">其他修复和改进</a></li>
<li><a class="reference internal" href="#id108">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id109">感谢名单</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-1-1">Mypy 1.1.1</a><ul>
<li><a class="reference internal" href="#dataclass-transform">对 <code class="docutils literal notranslate"><span class="pre">dataclass_transform</span></code> 的支持</a></li>
<li><a class="reference internal" href="#id110">方法分配的专用错误代码</a></li>
<li><a class="reference internal" href="#id111">崩溃修复</a></li>
<li><a class="reference internal" href="#id112">缓存损坏修复</a></li>
<li><a class="reference internal" href="#id113">Mypyc 修复和改进</a></li>
<li><a class="reference internal" href="#id114">修复检测未定义名称（使用前定义）</a></li>
<li><a class="reference internal" href="#id115">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id116">Stubtest 改进</a></li>
<li><a class="reference internal" href="#id117">错误报告和消息的变化</a></li>
<li><a class="reference internal" href="#id118">其他修复和改进</a></li>
<li><a class="reference internal" href="#id119">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id120">鸣谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mypy-1-0">Mypy 1.0</a><ul>
<li><a class="reference internal" href="#id121">新的发布版本方案</a></li>
<li><a class="reference internal" href="#id122">性能改进</a></li>
<li><a class="reference internal" href="#id123">提醒使用未定义的变量</a></li>
<li><a class="reference internal" href="#id124">检测可能未定义的变量（实验性）</a></li>
<li><a class="reference internal" href="#self">支持 “Self” 类型</a></li>
<li><a class="reference internal" href="#id125">支持在类型别名中使用 ParamSpec</a></li>
<li><a class="reference internal" href="#id126">ParamSpec 和泛型自类型不再是实验性</a></li>
<li><a class="reference internal" href="#id127">其他新功能</a></li>
<li><a class="reference internal" href="#id128">修复崩溃问题</a></li>
<li><a class="reference internal" href="#id129">错误报告改进</a></li>
<li><a class="reference internal" href="#mypyc-match">Mypyc：支持 match 语句</a></li>
<li><a class="reference internal" href="#id130">其他 Mypyc 修复和改进</a></li>
<li><a class="reference internal" href="#id131">文档改进</a></li>
<li><a class="reference internal" href="#id132">Stubtest 改进</a></li>
<li><a class="reference internal" href="#id133">Stubgen 改进</a></li>
<li><a class="reference internal" href="#id134">其他显著修复和改进</a></li>
<li><a class="reference internal" href="#id135">Typeshed 更新</a></li>
<li><a class="reference internal" href="#id136">致谢</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id137">以前的版本</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=48a57134"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    </body>
</html>