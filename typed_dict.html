<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="最终名称, 方法和类(Final)" href="final_attrs.html" /><link rel="prev" title="字面量类型(Literal types)和枚举(Enums)" href="literal_types.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>TypedDict - mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/mypy_light.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">mypy 1.13.0+dev.8a8d58c8ce71cf4aa7a622681da888eeb514a8b3 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">第一步</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheat_sheet_py3.html">类型提示备忘单</a></li>
<li class="toctree-l1"><a class="reference internal" href="existing_code.html">在现有代码库中使用 mypy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">类型系统参考</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="builtin_types.html">内置类型(Built-in)</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_inference_and_annotations.html">类型推断和类型注解(annotations)</a></li>
<li class="toctree-l1"><a class="reference internal" href="kinds_of_types.html">类型的种类(kinds)</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_basics.html">Class 基础(basics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="runtime_troubles.html">运行时的注解问题(Annotation issues)</a></li>
<li class="toctree-l1"><a class="reference internal" href="protocols.html">协议(Protocol)与结构化子类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic_typing.html">动态类型代码(Dynamically)</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_narrowing.html">类型缩小(narrowing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="duck_type_compatibility.html">鸭子类型兼容性</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubs.html">存根文件(Stub)</a></li>
<li class="toctree-l1"><a class="reference internal" href="generics.html">泛型(Generics)</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_types.html">更多类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="literal_types.html">字面量类型(Literal types)和枚举(Enums)</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">TypedDict</a></li>
<li class="toctree-l1"><a class="reference internal" href="final_attrs.html">最终名称, 方法和类(Final)</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaclasses.html">元类(Metaclasses)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">配置和运行 mypy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="running_mypy.html">运行 mypy 和管理导入(imports)</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line.html">mypy命令行(command line)</a></li>
<li class="toctree-l1"><a class="reference internal" href="config_file.html">mypy 配置文件(mypy configuration file)</a></li>
<li class="toctree-l1"><a class="reference internal" href="inline_config.html">内联配置(Inline configuration)</a></li>
<li class="toctree-l1"><a class="reference internal" href="mypy_daemon.html">Mypy 守护进程 (mypy 服务)</a></li>
<li class="toctree-l1"><a class="reference internal" href="installed_packages.html">使用已安装的包(Using installed packages)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending_mypy.html">扩展和集成 mypy(Extending and integrating mypy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubgen.html">自动存根生成(Automatic stub generation) (stubgen)</a></li>
<li class="toctree-l1"><a class="reference internal" href="stubtest.html">自动化存根测试(Automatic stub testing)(stubtest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">其他</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common_issues.html">常见问题及解决方案(Common issues and solutions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_python_features.html">支持的 Python 特性(Supported Python features)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_codes.html">错误代码(Error codes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_code_list.html">默认启用的错误代码(Error codes enabled by default)</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_code_list2.html">可选检查的错误代码(Error codes for optional checks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional_features.html">附加功能(Additional features)</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常见问题解答(Frequently Asked Questions)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Mypy 版本说明</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">项目链接</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/python/mypy">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mypy-lang.org/">Website</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/python/mypy/blob/master/docs/source/typed_dict.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/python/mypy/edit/master/docs/source/typed_dict.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="typeddict">
<span id="id1"></span><h1>TypedDict<a class="headerlink" href="#typeddict" title="Link to this heading">¶</a></h1>
<p>Python 程序经常使用字符串键的字典来表示对象。<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 让你可以为表示具有固定模式的字典提供精确的类型，例如 <code class="docutils literal notranslate"><span class="pre">{'id':</span> <span class="pre">1,</span> <span class="pre">'items':</span> <span class="pre">['x']}</span></code> 。</p>
<p>这里是一个典型的例子：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Blade Runner&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">1982</span><span class="p">}</span>
</pre></div>
</div>
<p>只期望一组固定的字符串键（上面的 <code class="docutils literal notranslate"><span class="pre">'name'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">'year'</span></code> )，每个键都有独立的值类型（上面的 <code class="docutils literal notranslate"><span class="pre">'name'</span></code> 为 <code class="docutils literal notranslate"><span class="pre">str</span></code>，而 <code class="docutils literal notranslate"><span class="pre">'year'</span></code> 为 <code class="docutils literal notranslate"><span class="pre">int</span></code> )。我们之前见过 <code class="docutils literal notranslate"><span class="pre">dict[K,</span> <span class="pre">V]</span></code> 类型，它让你声明统一的字典类型，其中每个值具有相同的类型，并且支持任意键。这显然不适合上面的 <code class="docutils literal notranslate"><span class="pre">movie</span></code>。相反，你可以使用 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 为像 <code class="docutils literal notranslate"><span class="pre">movie</span></code> 这样的对象提供精确的类型，其中每个字典值的类型取决于键：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="n">Movie</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Movie&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>

<span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Blade Runner&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">1982</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Movie</span></code> 是一个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类型，包含两个项目：<code class="docutils literal notranslate"><span class="pre">'name'</span></code> (类型为 <code class="docutils literal notranslate"><span class="pre">str</span></code> )和 <code class="docutils literal notranslate"><span class="pre">'year'</span></code> (类型为 <code class="docutils literal notranslate"><span class="pre">int</span></code> )。注意我们为 <code class="docutils literal notranslate"><span class="pre">movie</span></code> 变量使用了显式类型注解。这个类型注解很重要——如果没有它，mypy 会尝试推断 <code class="docutils literal notranslate"><span class="pre">movie</span></code> 为一个常规的、统一的 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 类型，这不是我们想要的。</p>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果你将 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象作为参数传递给函数，通常不需要类型注解，因为 mypy 可以根据声明的参数类型推断所需的类型。此外，如果赋值目标之前已经定义，并且具有 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类型，mypy 会将分配的值视为 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>，而不是 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>。</p>
</div>
<p>现在 mypy 会将这些视为有效：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="c1"># 可以；name 的类型是 str</span>
<span class="n">year</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>  <span class="c1"># 可以；year 的类型是 int</span>
</pre></div>
</div>
<p>Mypy 会将无效键检测为错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">director</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;director&#39;</span><span class="p">]</span>  <span class="c1"># 错误：&#39;director&#39; 不是有效的键</span>
</pre></div>
</div>
<p>Mypy 还会拒绝将运行时计算的表达式作为键，因为它无法验证这是否是有效键。你只能使用字符串字面量作为 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 键。</p>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类型对象也可以作为构造函数。它在运行时返回一个普通的 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 对象——<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 不定义新的运行时类型：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">toy_story</span> <span class="o">=</span> <span class="n">Movie</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Toy Story&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1995</span><span class="p">)</span>
</pre></div>
</div>
<p>这等同于直接使用 <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> 或 <code class="docutils literal notranslate"><span class="pre">dict(key=value,</span> <span class="pre">...)</span></code> 构造字典。构造函数的形式有时很方便，因为它可以在没有类型注解的情况下使用，并且还使对象的类型明确。</p>
<p>像所有类型一样，<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 可以用作构建任意复杂类型的组件。例如，你可以定义嵌套的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 和包含 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 项的容器。与大多数其他类型不同，mypy 使用结构兼容性检查（或结构子类型）来处理 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>。具有额外项目的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象与（子类型）更窄的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 兼容，前提是项目类型兼容（<em>完整性</em> 也影响子类型，具体讨论如下）。</p>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象不是常规 <code class="docutils literal notranslate"><span class="pre">dict[...]</span></code> 类型的子类型（反之亦然），因为 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> 允许添加和删除任意键，而 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 则不然。然而，任何 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象都是 <code class="docutils literal notranslate"><span class="pre">Mapping[str,</span> <span class="pre">object]</span></code> 的子类型（即兼容），因为 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/collections.abc.html#collections.abc.Mapping" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a> 仅提供对字典项的只读访问：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_typed_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">print_typed_dict</span><span class="p">(</span><span class="n">Movie</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Toy Story&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1995</span><span class="p">))</span>  <span class="c1"># 可以</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>除非你使用的是 Python 3.8 或更高版本（在标准库 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/typing.html#module-typing" title="（在 Python v3.13）"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> 模块中提供 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> )，否则你需要使用 pip 安装 <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> 来使用 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python3 -m pip install --upgrade typing-extensions
</pre></div>
</div>
</div>
<section id="totality">
<h2>Totality<a class="headerlink" href="#totality" title="Link to this heading">¶</a></h2>
<p>By default mypy ensures that a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object has all the specified
keys. This will be flagged as an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: &#39;year&#39; missing</span>
<span class="n">toy_story</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Toy Story&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Sometimes you want to allow keys to be left out when creating a
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object. You can provide the <code class="docutils literal notranslate"><span class="pre">total=False</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">TypedDict(...)</span></code> to achieve this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GuiOptions</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span>
    <span class="s1">&#39;GuiOptions&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">options</span><span class="p">:</span> <span class="n">GuiOptions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Okay</span>
<span class="n">options</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
</pre></div>
</div>
<p>You may need to use <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> to access items of a partial (non-total)
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, since indexing using <code class="docutils literal notranslate"><span class="pre">[]</span></code> could fail at runtime.
However, mypy still lets use <code class="docutils literal notranslate"><span class="pre">[]</span></code> with a partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> -- you
just need to be careful with it, as it could result in a <a class="reference external" href="https://docs.python.org/zh-cn/3/library/exceptions.html#KeyError" title="（在 Python v3.13）"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.
Requiring <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> everywhere would be too cumbersome. (Note that you
are free to use <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> with total <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s as well.)</p>
<p>Keys that aren't required are shown with a <code class="docutils literal notranslate"><span class="pre">?</span></code> in error messages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Revealed type is &quot;TypedDict(&#39;GuiOptions&#39;, {&#39;language&#39;?: builtins.str,</span>
<span class="c1">#                                            &#39;color&#39;?: builtins.str})&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>Totality also affects structural compatibility. You can't use a partial
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> when a total one is expected. Also, a total <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is not
valid when a partial one is expected.</p>
</section>
<section id="supported-operations">
<h2>Supported operations<a class="headerlink" href="#supported-operations" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> objects support a subset of dictionary operations and methods.
You must use string literals as keys when calling most of the methods,
as otherwise mypy won't be able to check that the key is valid. List
of supported operations:</p>
<ul class="simple">
<li><p>Anything included in <a class="reference external" href="https://docs.python.org/zh-cn/3/library/collections.abc.html#collections.abc.Mapping" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">d[key]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len(d)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code> (iteration)</p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.get(key[,</span> <span class="pre">default])</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.keys" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.keys()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.values" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.values()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.items" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.items()</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.copy" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.copy()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.setdefault" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.setdefault(key,</span> <span class="pre">default)</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.update" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d1.update(d2)</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.pop" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.pop(key[,</span> <span class="pre">default])</span></code></a> (partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">d[key]</span></code> (partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s only)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.clear" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clear()</span></code></a> and <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.popitem" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">popitem()</span></code></a> are not supported since they are unsafe
-- they could delete required <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> items that are not visible to
mypy because of structural subtyping.</p>
</div>
</section>
<section id="id2">
<h2>完整性(Totality)<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>默认情况下，mypy 确保 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象具有所有指定的键。否则将被标记为错误：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 错误：缺少 &#39;year&#39;</span>
<span class="n">toy_story</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Toy Story&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>有时你希望在创建 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象时允许省略键。你可以向 <code class="docutils literal notranslate"><span class="pre">TypedDict(...)</span></code> 提供 <code class="docutils literal notranslate"><span class="pre">total=False</span></code> 参数来实现这一点：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GuiOptions</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span>
    <span class="s1">&#39;GuiOptions&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">options</span><span class="p">:</span> <span class="n">GuiOptions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 可以</span>
<span class="n">options</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
</pre></div>
</div>
<p>你可能需要使用 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> 来访问部分（非总计）``TypedDict`` 的项，因为使用 <code class="docutils literal notranslate"><span class="pre">[]</span></code> 索引可能在运行时失败。然而，mypy 仍然允许在部分 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 上使用 <code class="docutils literal notranslate"><span class="pre">[]</span></code>——你只需要小心，因为这可能导致 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/exceptions.html#KeyError" title="（在 Python v3.13）"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> 。在任何地方都要求使用 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> 会太繁琐。（请注意，你也可以在使用了 total 参数的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 使用 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a>。）</p>
<p>在错误消息中，不是必需的键会用 <code class="docutils literal notranslate"><span class="pre">?</span></code> 显示：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 显示的类型是 &quot;TypedDict(&#39;GuiOptions&#39;, {&#39;language&#39;?: builtins.str,</span>
<span class="c1">#                                            &#39;color&#39;?: builtins.str})&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>完整性也会影响结构兼容性。当期望一个完整(total)的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 时，你不能使用部分(partial)的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>。同样，当期望一个部分(partial)的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 时，完整(total)的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 也是无效的。</p>
</section>
<section id="id3">
<h2>支持的操作(Supported operations)<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 对象支持一组字典操作和方法的子集。在调用大多数方法时，必须使用字符串字面量作为键，否则 mypy 将无法检查键是否有效。支持的操作列表：</p>
<ul class="simple">
<li><p>包含在 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/collections.abc.html#collections.abc.Mapping" title="（在 Python v3.13）"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a> 中的任何内容：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">d[key]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len(d)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code> （迭代）</p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.get" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.get(key[,</span> <span class="pre">default])</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.keys" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.keys()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.values" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.values()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.items" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.items()</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.copy" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.copy()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.setdefault" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.setdefault(key,</span> <span class="pre">default)</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.update" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d1.update(d2)</span></code></a></p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.pop(key[,</span> <span class="pre">default])</span> <span class="pre">&lt;dict.pop&gt;`（仅适用于部分(partial)</span> <span class="pre">``TypedDict`()</span></code> )</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">d[key]</span></code> (仅适用于部分(partial) <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> )</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p><a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.clear" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clear()</span></code></a> 和 <a class="reference external" href="https://docs.python.org/zh-cn/3/library/stdtypes.html#dict.popitem" title="（在 Python v3.13）"><code class="xref py py-meth docutils literal notranslate"><span class="pre">popitem()</span></code></a> 不受支持，因为它们不安全——它们可能删除必需的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 项，而这些项由于结构子类型(structural subtyping)从而对 mypy 不可见。</p>
</div>
</section>
<section id="class-based">
<h2>基于类的语法(Class-based)<a class="headerlink" href="#class-based" title="Link to this heading">¶</a></h2>
<p>在 Python 3.6 及更高版本中，支持一种替代的基于类的语法来定义 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>  <span class="c1"># 在 Python 3.7 及更早版本中使用 &quot;from typing_extensions&quot;</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>上述定义与原始的 <code class="docutils literal notranslate"><span class="pre">Movie</span></code> 定义等效。它实际上并不定义一个真实的类。此语法还支持一种继承形式——子类可以定义附加项。然而，这主要是一种符号快捷方式。由于 mypy 对 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 使用结构兼容性，因此兼容性不需要继承。以下是继承的示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">BookBasedMovie</span><span class="p">(</span><span class="n">Movie</span><span class="p">):</span>
    <span class="n">based_on</span><span class="p">:</span> <span class="nb">str</span>
</pre></div>
</div>
<p>现在 <code class="docutils literal notranslate"><span class="pre">BookBasedMovie</span></code> 具有键 <code class="docutils literal notranslate"><span class="pre">name</span></code>、<code class="docutils literal notranslate"><span class="pre">year</span></code> 和 <code class="docutils literal notranslate"><span class="pre">based_on</span></code>。</p>
</section>
<section id="mixing">
<h2>混合必须和非必须项(Mixing)<a class="headerlink" href="#mixing" title="Link to this heading">¶</a></h2>
<p>除了允许在 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 类型之间重用外，继承还允许你在单个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 中混合必需项和非必需项（使用 <code class="docutils literal notranslate"><span class="pre">total=False</span></code> )。示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MovieBase</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">MovieBase</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">based_on</span><span class="p">:</span> <span class="nb">str</span>
</pre></div>
</div>
<p>现在 <code class="docutils literal notranslate"><span class="pre">Movie</span></code> 具有必需键 <code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">year</span></code>, 而 <code class="docutils literal notranslate"><span class="pre">based_on</span></code> 在构造对象时可以省略。具有必需键和非必需键混合的 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> (如上面的 <code class="docutils literal notranslate"><span class="pre">Movie</span></code> )仅在另一个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 中所有必需键都是第一个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 中的必需键，并且另一个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 的所有非必需键也是第一个 <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> 的非必需键时，才会兼容。</p>
</section>
<section id="read-only">
<h2>只读项(Read-only)<a class="headerlink" href="#read-only" title="Link to this heading">¶</a></h2>
<p>你可以使用在 Python 3.13 中引入的 <code class="docutils literal notranslate"><span class="pre">typing.ReadOnly</span></code> 或 <code class="docutils literal notranslate"><span class="pre">typing_extensions.ReadOnly</span></code> 来标记 TypedDict 项为只读（<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0705/"><strong>PEP 705</strong></a>）：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="c1"># 或在 Python 3.13+ 中使用 &quot;from typing ...&quot;</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">ReadOnly</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">num_watched</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">m</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jaws&quot;</span><span class="p">,</span> <span class="s2">&quot;num_watched&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">m</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;The Godfather&quot;</span>  <span class="c1"># 错误：“name”是只读的</span>
<span class="n">m</span><span class="p">[</span><span class="s2">&quot;num_watched&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 正确</span>
</pre></div>
</div>
<p>具有可变项的 TypedDict 可以分配给具有相应只读项的 TypedDict ，并且项的类型可以 <a class="reference internal" href="generics.html#variance-of-generics"><span class="std std-ref">协变</span></a>：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">year</span><span class="p">:</span> <span class="n">ReadOnly</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">process_entry</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">Entry</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">m</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Jaws&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1975</span><span class="p">}</span>
<span class="n">process_entry</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>  <span class="c1"># 正确</span>
</pre></div>
</div>
</section>
<section id="typeddicts-unions">
<h2>TypedDicts的联合(Unions)<a class="headerlink" href="#typeddicts-unions" title="Link to this heading">¶</a></h2>
<p>由于在运行时，TypedDict 实际上只是常规字典，因此不能使用 <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> 检查来区分 TypedDict 的不同变体，如同在常规对象中那样。</p>
<p>相反，你可以使用 <a class="reference internal" href="literal_types.html#tagged-unions"><span class="std std-ref">标记联合模式</span></a>。文档中引用的部分提供了完整的描述和示例，但简而言之，你需要给每个 TypedDict 相同的键，其中每个值具有唯一的 <a class="reference internal" href="literal_types.html#literal-types"><span class="std std-ref">字面量类型</span></a>。然后，检查该键以区分你的 TypedDicts。</p>
</section>
<section id="typeddict-inline">
<h2>内联TypedDict类型(Inline)<a class="headerlink" href="#typeddict-inline" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>这是一个实验性（非标准）功能。使用
<code class="docutils literal notranslate"><span class="pre">--enable-incomplete-feature=InlineTypedDict</span></code> 来启用。</p>
</div>
<p>有时你可能想定义一个复杂的嵌套 JSON 架构，或为返回 TypedDict 的一次性函数进行注解。在这种情况下，使用内联 TypedDict 语法可能会很方便。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_values</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">{</span><span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}:</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="s2">&quot;test&quot;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Response</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># 在这里使用内联语法可以避免定义两个额外的 TypedDict。</span>
    <span class="n">content</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">[{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}]}</span>
</pre></div>
</div>
<p>内联 TypedDict 也可以作为类型别名的目标，但由于与常规变量的歧义，它仅允许用于（较新）显式类型别名形式：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeAlias</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>  <span class="c1"># 创建一个类型为 dict[str, type[int]] 的变量</span>
<span class="n">Y</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>  <span class="c1"># 创建一个类型别名</span>
<span class="nb">type</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>  <span class="c1"># 同上（仅适用于 Python 3.12+）</span>
</pre></div>
</div>
<p>此外，由于与运行时类型检查的不兼容，强烈建议在联合类型中 <em>不</em> 使用内联语法。</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="final_attrs.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">最终名称, 方法和类(Final)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="literal_types.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">字面量类型(Literal types)和枚举(Enums)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2012-2022 Jukka Lehtosalo and mypy contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">TypedDict</a><ul>
<li><a class="reference internal" href="#totality">Totality</a></li>
<li><a class="reference internal" href="#supported-operations">Supported operations</a></li>
<li><a class="reference internal" href="#id2">完整性(Totality)</a></li>
<li><a class="reference internal" href="#id3">支持的操作(Supported operations)</a></li>
<li><a class="reference internal" href="#class-based">基于类的语法(Class-based)</a></li>
<li><a class="reference internal" href="#mixing">混合必须和非必须项(Mixing)</a></li>
<li><a class="reference internal" href="#read-only">只读项(Read-only)</a></li>
<li><a class="reference internal" href="#typeddicts-unions">TypedDicts的联合(Unions)</a></li>
<li><a class="reference internal" href="#typeddict-inline">内联TypedDict类型(Inline)</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=48a57134"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    </body>
</html>